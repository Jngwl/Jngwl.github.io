

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.ico">
  <link rel="icon" type="image/png" href="/img/favicon.ico">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="æ¸…é£ä¸å½’_G">
  <meta name="keywords" content="">
  <title>RedisåŸºç¡€è‡ªæŸ¥æ‰‹å†Œ - æ¸…é£ä¸å½’_G</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.5.3/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      
        
          
          
          
        
        <link  rel="stylesheet" href="https://cdn.staticfile.org/prism/1.22.0/themes/prism-tomorrow.min.css" />
      
      
    
  

  
    <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />
  



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- è‡ªå®šä¹‰æ ·å¼ä¿æŒåœ¨æœ€åº•éƒ¨ -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"www.jngwl.top","root":"/","version":"1.8.5","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"copy_btn":true,"image_zoom":{"enable":true},"lazyload":{"enable":true,"onlypost":false},"web_analytics":{"enable":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"ViwB1XmjsmmXpFx2gikUmM5V-gzGzoHsz","app_key":"7r6Y8CzBkl8MJwPNmCqSdLWW","server_url":"https://viwb1xmj.lc-cn-n1-shared.com"}}};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.2.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>æ¸…é£ä¸å½’_G</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                é¦–é¡µ
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                åˆ†ç±»
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                æ ‡ç­¾
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                å‹é“¾
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                å…³äº
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner intro-2" id="background" parallax=true
         style="background: url('https://hexo-blog-1254804803.cos.ap-shanghai.myqcloud.com/img/20201121211851.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="RedisåŸºç¡€è‡ªæŸ¥æ‰‹å†Œ">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-01-22 09:38" pubdate>
        2021å¹´1æœˆ22æ—¥ ä¸Šåˆ
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      8.3k å­—
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      101
       åˆ†é’Ÿ
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">RedisåŸºç¡€è‡ªæŸ¥æ‰‹å†Œ</h1>
            
              <p class="note note-info">
                
                  æœ¬æ–‡æœ€åæ›´æ–°äºï¼š2021å¹´1æœˆ30æ—¥ æ™šä¸Š
                
              </p>
            
            <div class="markdown-body">
              <h2 id="ä¸€ã€NoSQLæ¦‚è¿°"><a href="#ä¸€ã€NoSQLæ¦‚è¿°" class="headerlink" title="ä¸€ã€NoSQLæ¦‚è¿°"></a>ä¸€ã€NoSQLæ¦‚è¿°</h2><h3 id="1ï¼‰ä»€ä¹ˆæ˜¯Nosql"><a href="#1ï¼‰ä»€ä¹ˆæ˜¯Nosql" class="headerlink" title="1ï¼‰ä»€ä¹ˆæ˜¯Nosql"></a>1ï¼‰ä»€ä¹ˆæ˜¯Nosql</h3><p>å…³ç³»å‹æ•°æ®åº“ï¼šåˆ—+è¡Œï¼ŒåŒä¸€ä¸ªè¡¨ä¸‹æ•°æ®çš„ç»“æ„æ˜¯ä¸€æ ·çš„ã€‚</p>
<p>éå…³ç³»å‹æ•°æ®åº“ï¼š<strong>æ•°æ®å­˜å‚¨æ²¡æœ‰å›ºå®šçš„æ ¼å¼ï¼Œå¹¶ä¸”å¯ä»¥è¿›è¡Œæ¨ªå‘æ‰©å±•</strong>ã€‚</p>
<p>NoSQLï¼ˆNot only SQLï¼‰æ³›æŒ‡éå…³ç³»å‹æ•°æ®åº“ã€‚</p>
<h3 id="2ï¼‰ç±»åˆ«"><a href="#2ï¼‰ç±»åˆ«" class="headerlink" title="2ï¼‰ç±»åˆ«"></a>2ï¼‰ç±»åˆ«</h3><div class="table-container">
<table>
<thead>
<tr>
<th>åˆ†ç±»</th>
<th>Examplesä¸¾ä¾‹</th>
<th>å…¸å‹åº”ç”¨åœºæ™¯</th>
<th>æ•°æ®æ¨¡å‹</th>
<th>ä¼˜ç‚¹</th>
<th>ç¼ºç‚¹</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>é”®å€¼å¯¹ï¼ˆkey-valueï¼‰</strong></td>
<td>Tokyo Cabinet/Tyrant, <strong>Redis</strong>, Voldemort, Oracle BDB</td>
<td>å†…å®¹ç¼“å­˜ï¼Œä¸»è¦ç”¨äºå¤„ç†å¤§é‡æ•°æ®çš„é«˜è®¿é—®è´Ÿè½½ï¼Œä¹Ÿç”¨äºä¸€äº›æ—¥å¿—ç³»ç»Ÿç­‰ç­‰ã€‚</td>
<td>Key æŒ‡å‘ Value çš„é”®å€¼å¯¹ï¼Œé€šå¸¸ç”¨hash tableæ¥å®ç°</td>
<td>æŸ¥æ‰¾é€Ÿåº¦å¿«</td>
<td>æ•°æ®æ— ç»“æ„åŒ–ï¼Œé€šå¸¸åªè¢«å½“ä½œå­—ç¬¦ä¸²æˆ–è€…äºŒè¿›åˆ¶æ•°æ®</td>
</tr>
<tr>
<td><strong>åˆ—å­˜å‚¨æ•°æ®åº“</strong></td>
<td>Cassandra, <strong>HBase</strong>, Riak</td>
<td>åˆ†å¸ƒå¼çš„æ–‡ä»¶ç³»ç»Ÿ</td>
<td>ä»¥åˆ—ç°‡å¼å­˜å‚¨ï¼Œå°†åŒä¸€åˆ—æ•°æ®å­˜åœ¨ä¸€èµ·</td>
<td>æŸ¥æ‰¾é€Ÿåº¦å¿«ï¼Œå¯æ‰©å±•æ€§å¼ºï¼Œæ›´å®¹æ˜“è¿›è¡Œåˆ†å¸ƒå¼æ‰©å±•</td>
<td>åŠŸèƒ½ç›¸å¯¹å±€é™</td>
</tr>
<tr>
<td><strong>æ–‡æ¡£å‹æ•°æ®åº“</strong></td>
<td>CouchDB, <strong>MongoDb</strong></td>
<td>Webåº”ç”¨ï¼ˆä¸Key-Valueç±»ä¼¼ï¼ŒValueæ˜¯ç»“æ„åŒ–çš„ï¼Œä¸åŒçš„æ˜¯æ•°æ®åº“èƒ½å¤Ÿäº†è§£Valueçš„å†…å®¹ï¼‰</td>
<td>Key-Valueå¯¹åº”çš„é”®å€¼å¯¹ï¼ŒValueä¸ºç»“æ„åŒ–æ•°æ®</td>
<td>æ•°æ®ç»“æ„è¦æ±‚ä¸ä¸¥æ ¼ï¼Œè¡¨ç»“æ„å¯å˜ï¼Œä¸éœ€è¦åƒå…³ç³»å‹æ•°æ®åº“ä¸€æ ·éœ€è¦é¢„å…ˆå®šä¹‰è¡¨ç»“æ„</td>
<td>æŸ¥è¯¢æ€§èƒ½ä¸é«˜ï¼Œè€Œä¸”ç¼ºä¹ç»Ÿä¸€çš„æŸ¥è¯¢è¯­æ³•ã€‚</td>
</tr>
<tr>
<td><strong>å›¾å½¢(Graph)æ•°æ®åº“</strong></td>
<td><strong>Neo4J</strong>, InfoGrid, Infinite Graph</td>
<td>ç¤¾äº¤ç½‘ç»œï¼Œæ¨èç³»ç»Ÿç­‰ã€‚ä¸“æ³¨äºæ„å»ºå…³ç³»å›¾è°±</td>
<td>å›¾ç»“æ„</td>
<td>åˆ©ç”¨å›¾ç»“æ„ç›¸å…³ç®—æ³•ã€‚æ¯”å¦‚æœ€çŸ­è·¯å¾„å¯»å€ï¼ŒNåº¦å…³ç³»æŸ¥æ‰¾ç­‰</td>
<td>å¾ˆå¤šæ—¶å€™éœ€è¦å¯¹æ•´ä¸ªå›¾åšè®¡ç®—æ‰èƒ½å¾—å‡ºéœ€è¦çš„ä¿¡æ¯ï¼Œè€Œä¸”è¿™ç§ç»“æ„ä¸å¤ªå¥½åšåˆ†å¸ƒå¼çš„é›†ç¾¤</td>
</tr>
</tbody>
</table>
</div>
<h2 id="äºŒã€Rediså…¥é—¨"><a href="#äºŒã€Rediså…¥é—¨" class="headerlink" title="äºŒã€Rediså…¥é—¨"></a>äºŒã€Rediså…¥é—¨</h2><h3 id="1ï¼‰æ¦‚è¿°"><a href="#1ï¼‰æ¦‚è¿°" class="headerlink" title="1ï¼‰æ¦‚è¿°"></a>1ï¼‰æ¦‚è¿°</h3><p>Redisï¼ˆRemote Dictionary Server )ï¼Œå³è¿œç¨‹å­—å…¸æœåŠ¡ï¼Œä¸€ä¸ªå¼€æºçš„ä½¿ç”¨ANSI Cè¯­è¨€ç¼–å†™ã€æ”¯æŒç½‘ç»œã€å¯åŸºäºå†…å­˜äº¦å¯æŒä¹…åŒ–çš„æ—¥å¿—å‹ã€<strong>Key-Valueæ•°æ®åº“</strong>ï¼Œå¹¶æä¾›å¤šç§è¯­è¨€çš„APIã€‚</p>
<p>ä¸memcachedä¸€æ ·ï¼Œä¸ºäº†ä¿è¯æ•ˆç‡ï¼Œ<strong>æ•°æ®éƒ½æ˜¯ç¼“å­˜åœ¨å†…å­˜ä¸­</strong>ã€‚åŒºåˆ«çš„æ˜¯redisä¼šå‘¨æœŸæ€§çš„æŠŠæ›´æ–°çš„æ•°æ®å†™å…¥ç£ç›˜æˆ–è€…æŠŠä¿®æ”¹æ“ä½œå†™å…¥è¿½åŠ çš„è®°å½•æ–‡ä»¶ï¼Œå¹¶ä¸”åœ¨æ­¤åŸºç¡€ä¸Šå®ç°äº†master-slave(ä¸»ä»)åŒæ­¥ã€‚</p>
<h3 id="2ï¼‰å®‰è£…ä¸å¯åŠ¨"><a href="#2ï¼‰å®‰è£…ä¸å¯åŠ¨" class="headerlink" title="2ï¼‰å®‰è£…ä¸å¯åŠ¨"></a>2ï¼‰å®‰è£…ä¸å¯åŠ¨</h3><p>ğŸŒ ä¸‹è½½æ–‡ä»¶å¹¶ç¼–è¯‘å®‰è£…ï¼š</p>
<ul>
<li><p>æ–‡ä»¶è·¯å¾„ï¼š<code>https://download.redis.io/releases/</code></p>
</li>
<li><p>é»˜è®¤å®‰è£…çš„è·¯å¾„ä¸º<code>/usr/local/bin</code>ï¼Œå®‰è£…å®Œä¹‹åè¯¥è·¯å¾„ä¸‹å°±æœ‰<code>redis-benchmarkã€redis-check-aofã€redis-check-rdbã€redis-cliã€redis-sentinelã€redis-server</code>å‡ ä¸ªæ–‡ä»¶</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># è§£å‹æ–‡ä»¶ï¼Œåˆ‡æ¢ç›®å½•</span>
<span class="token function">tar</span> xzf redis-5.0.7.tar.gz
<span class="token builtin class-name">cd</span> redis-5.0.7

<span class="token comment"># ç¼–è¯‘å®‰è£…</span>
<span class="token function">make</span>
<span class="token function">make</span> <span class="token function">install</span>

<span class="token comment"># æµ‹è¯•</span>
yum <span class="token function">install</span>  tlp
nake <span class="token builtin class-name">test</span></code></pre>
</li>
</ul>
<p>ğŸŒ å¼€å¯åå°å¯åŠ¨</p>
<ul>
<li>å°†redis-5.0.7æ–‡ä»¶å¤¹ä¸‹çš„é…ç½®æ–‡ä»¶å¤åˆ¶åˆ°optç›®å½•ä¸‹ï¼Œ<code>cp /opt/redis-5.0.7/redis.conf myRedisConfig</code></li>
<li>å°†é…ç½®æ–‡ä»¶ä¸­çš„<code>daemonize no</code>æ”¹ä¸º<code>daemonize yes</code></li>
</ul>
<p>ğŸŒ å¯åŠ¨RedisæœåŠ¡ï¼š<code>redis-server myRedisConfig</code></p>
<p>ğŸŒ è¿æ¥æŒ‡å®šçš„ç«¯å£å·ï¼ŒRedisé»˜è®¤ç«¯å£6379:<code>redis-cli -p 6379</code></p>
<p>ğŸŒ æ€§èƒ½æµ‹è¯•ï¼š<code>redis-benchmark -h localhost -p 6379 -c 100 -n 100000</code></p>
<p>ğŸŒ å…³é—­æœåŠ¡ï¼š<code>shutdown</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@VM-0-13-centos bin<span class="token punctuation">]</span><span class="token comment"># redis-server myRedisConfig</span>
<span class="token number">23002</span>:C <span class="token number">21</span> Jan <span class="token number">2021</span> 09:54:39.333 <span class="token comment"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span>
<span class="token number">23002</span>:C <span class="token number">21</span> Jan <span class="token number">2021</span> 09:54:39.333 <span class="token comment"># Redis version=5.0.7, bits=64, commit=00000000, modified=0, pid=23002, just started</span>
<span class="token number">23002</span>:C <span class="token number">21</span> Jan <span class="token number">2021</span> 09:54:39.333 <span class="token comment"># Configuration loaded</span>

<span class="token punctuation">[</span>root@VM-0-13-centos bin<span class="token punctuation">]</span><span class="token comment"># redis-cli -p 6379</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> <span class="token function">ping</span>
PONG
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> <span class="token builtin class-name">set</span> name gaowl
OK
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> get name
<span class="token string">"gaowl"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> keys *
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"name"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> <span class="token builtin class-name">exit</span></code></pre>
<h3 id="3ï¼‰åŸºç¡€çŸ¥è¯†"><a href="#3ï¼‰åŸºç¡€çŸ¥è¯†" class="headerlink" title="3ï¼‰åŸºç¡€çŸ¥è¯†"></a>3ï¼‰åŸºç¡€çŸ¥è¯†</h3><ul>
<li>Redisé»˜è®¤æœ‰16ä¸ªæ•°æ®åº“ï¼š<code>DB0~DB15</code>ï¼Œé»˜è®¤ä½¿ç”¨<code>DB0</code>ï¼Œ<ul>
<li><code>select n</code>ï¼šåˆ‡æ¢æ•°æ®åº“</li>
<li><code>dbsize</code>ï¼šæŸ¥çœ‹å½“å‰æ•°æ®åº“çš„å¤§å°ï¼ˆsizeä¸keyçš„ä¸ªæ•°æœ‰å…³ï¼‰</li>
<li><code>flushdb</code>ï¼šæ¸…ç©ºå½“å‰æ•°æ®åº“</li>
<li><code>flushall</code>ï¼šæ¸…ç©ºæ‰€æœ‰æ•°æ®åº“ã€‚</li>
</ul>
</li>
<li>Redisæ˜¯å•çº¿ç¨‹çš„ï¼Œä½†ä¸ºä½•å•çº¿ç¨‹è¿˜è¿™ä¹ˆå¿«å‘¢ï¼Ÿ<ul>
<li>Rediså°†æ‰€æœ‰æ•°æ®éƒ½æ”¾åœ¨å†…å­˜ä¸­ï¼Œå½“é‡‡ç”¨å¤šçº¿ç¨‹æ—¶ï¼ŒCPUé—´çš„åˆ‡æ¢ä¼šæµªè´¹ä¸€å®šçš„æ—¶é—´ï¼Œè€Œå•çº¿ç¨‹æ˜¯æ— éœ€åˆ‡æ¢CPUçš„ï¼Œå¤šæ¬¡è¯»å†™éƒ½æ˜¯åœ¨ä¸€ä¸ªCPUä¸Šçš„ï¼Œå› æ­¤åœ¨å†…å­˜å­˜å‚¨æ•°æ®æƒ…å†µä¸‹ï¼Œå•çº¿ç¨‹æ˜¯ä¼˜äºå¤šçº¿ç¨‹çš„ã€‚ï¼ˆï¼Ÿï¼Ÿï¼Ÿç‹—å±ï¼‰ã€‚</li>
<li>Redisçš„æ€§èƒ½ç“¶é¢ˆä¸æ˜¯å–å†³äºCPU,è€Œæ˜¯æœºå™¨å†…å­˜å’Œç½‘ç»œå¸¦å®½ã€‚</li>
</ul>
</li>
</ul>
<h2 id="ä¸‰ã€æ•°æ®ç±»å‹"><a href="#ä¸‰ã€æ•°æ®ç±»å‹" class="headerlink" title="ä¸‰ã€æ•°æ®ç±»å‹"></a>ä¸‰ã€æ•°æ®ç±»å‹</h2><p>åœ¨redisä¸­æ— è®ºä»€ä¹ˆæ•°æ®ç±»å‹ï¼Œåœ¨æ•°æ®åº“ä¸­éƒ½æ˜¯ä»¥<code>key-value</code>å½¢å¼ä¿å­˜ï¼Œé€šè¿‡å¯¹Redis-keyçš„æ“ä½œï¼Œæ¥å®Œæˆæ•°æ®çš„æ“ä½œ</p>
<ul>
<li><p><code>keys *</code> ï¼šæŸ¥çœ‹å½“å‰æ•°æ®åº“ä¸­æ‰€æœ‰çš„keyã€‚</p>
</li>
<li><p><code>exists key</code>ï¼šåˆ¤æ–­é”®æ˜¯å¦å­˜åœ¨</p>
</li>
<li><p><code>move key db</code>ï¼šå°†æŸä¸ªé”®å€¼å¯¹ ç§»åŠ¨åˆ° æŒ‡å®šæ•°æ®åº“</p>
</li>
<li><p><code>expire key second</code>ï¼šè®¾ç½®è¿‡æœŸæ—¶é—´</p>
</li>
<li><p><code>ttl key</code>ï¼šæŸ¥çœ‹è¿˜æœ‰å¤šå°‘ç§’è¿‡æœŸï¼Œ-2è¡¨ç¤ºå·²è¿‡æœŸï¼Œ-1è¡¨ç¤ºæ°¸ä¸è¿‡æœŸ</p>
</li>
<li><p><code>type key</code>ï¼šæŸ¥çœ‹valueçš„æ•°æ®ç±»å‹</p>
</li>
</ul>
<ul>
<li><p><code>rename key newkey</code>ï¼šä¿®æ”¹ key çš„åç§°</p>
</li>
<li><p><code>renamenx key newkey</code>ï¼šä»…å½“ newkey ä¸å­˜åœ¨æ—¶ï¼Œå°† key æ”¹åä¸º newkey ã€‚</p>
</li>
</ul>
<h3 id="1ï¼‰String-å­—ç¬¦ä¸²"><a href="#1ï¼‰String-å­—ç¬¦ä¸²" class="headerlink" title="1ï¼‰String å­—ç¬¦ä¸²"></a>1ï¼‰String å­—ç¬¦ä¸²</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">set</span> key value  æ·»åŠ é”®å€¼å¯¹
del key  åˆ é™¤é”®å€¼å¯¹
append key value   å‘æŒ‡å®šçš„keyçš„valueåè¿½åŠ å­—ç¬¦ä¸²	
get key     æŸ¥è¯¢å¯¹åº”keyçš„value
strlen key	è·å–keyå¯¹åº”çš„valueçš„é•¿åº¦

decr/incr key	å°†æŒ‡å®škeyçš„valueæ•°å€¼è¿›è¡Œ+1/-1<span class="token punctuation">(</span>ä»…å¯¹æ•°å­—è¿›è¡Œæ“ä½œ<span class="token punctuation">)</span>	
incrby/decrby key n	æŒ‰æŒ‡å®šçš„æ­¥é•¿å¯¹æ•°å€¼è¿›è¡ŒåŠ å‡	

getrange key start end	æŒ‰èµ·æ­¢ä½ç½®è·å–å­—ç¬¦ä¸²ï¼ˆé—­åŒºé—´ï¼Œèµ·æ­¢ä½ç½®éƒ½å–ï¼‰
setrange key offset value	ç”¨æŒ‡å®šçš„value æ›¿æ¢ keyä¸­ offsetå¼€å§‹çš„å€¼


setex key seconds value  æ·»åŠ é”®å€¼å¯¹å¹¶è®¾ç½®è¿‡æœŸæ—¶é—´<span class="token punctuation">(</span>s<span class="token punctuation">)</span>--set with expire
setnx key value	ä»…å½“keyä¸å­˜åœ¨æ—¶æ·»åŠ --set <span class="token keyword">if</span> not exist
getset key value	è®¾ç½®æ–°å€¼ï¼ŒåŒæ—¶è·å–æ—§å€¼

mset key1 value1 <span class="token punctuation">[</span>key2 value2<span class="token punctuation">..</span><span class="token punctuation">]</span>	æ‰¹é‡seté”®å€¼å¯¹
mget key1 <span class="token punctuation">[</span>key2<span class="token punctuation">..</span><span class="token punctuation">]</span>	æ‰¹é‡è·å–å¤šä¸ªkeyä¿å­˜çš„å€¼
msetnx key1 value1 <span class="token punctuation">[</span>key2 value2<span class="token punctuation">..</span><span class="token punctuation">]</span>	æ‰¹é‡è®¾ç½®é”®å€¼å¯¹ï¼Œä»…å½“å‚æ•°ä¸­æ‰€æœ‰çš„keyéƒ½ä¸å­˜åœ¨æ—¶æ‰§è¡Œ</code></pre>
<h3 id="2ï¼‰List-åˆ—è¡¨"><a href="#2ï¼‰List-åˆ—è¡¨" class="headerlink" title="2ï¼‰List åˆ—è¡¨"></a>2ï¼‰List åˆ—è¡¨</h3><p>åº•å±‚å®é™…ä¸Šæ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œå·¦å³ä¸¤ä¾§å‡å¯ä»¥æ’å…¥å…ƒç´ ã€‚</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ã€1.æ’å…¥å…ƒç´ ã€‘</span>
lpush/rpush key value1 value2 value3<span class="token punctuation">..</span>.  <span class="token comment"># ä»å·¦/å³æ’å…¥å¤šä¸ªå€¼</span>
linsert key before/after value value1  <span class="token comment"># åœ¨valueå‰é¢/åé¢æ’å…¥value1å€¼</span>

<span class="token comment"># ã€2.å¼¹å‡ºå…ƒç´ ã€‘</span>
lpop/rpop key  <span class="token comment"># ä»å·¦/å³è¾¹å¼¹å‡ºå…ƒç´ </span>
rpoplpush key1 key2  <span class="token comment"># ä»key1åˆ—è¡¨å¼¹å‡ºä¸€ä¸ªå€¼ï¼Œæ’å…¥key2åˆ—è¡¨å·¦è¾¹                          </span>

<span class="token comment"># ã€3.æŸ¥çœ‹å…ƒç´ ã€‘</span>
lrange key start stop  <span class="token comment"># æŸ¥çœ‹keyä¸­æŒ‡å®šèŒƒå›´å†…çš„valueï¼ˆç´¢å¼•æŒ‰ä»å·¦åˆ°å³ï¼‰</span>
<span class="token comment"># æŸ¥çœ‹keyä¸­æŒ‡å®šç´¢å¼•ä½ç½®å¤„çš„valueï¼ˆç´¢å¼•æŒ‰ä»å·¦åˆ°å³æ¥ï¼‰</span>
lindex key index   

<span class="token comment"># è·å–keyå¯¹åº”listçš„é•¿åº¦</span>
llen key    
 
<span class="token comment"># ã€4.åˆ é™¤å…ƒç´ ã€‘</span>
lrem key n value1
    nä¸ºæ­£ï¼Œä»å·¦è¾¹åˆ é™¤nä¸ªç¬¦åˆvalue1çš„å€¼ï¼ˆä»å·¦åˆ°å³ï¼‰ 
    nä¸ºè´Ÿï¼Œä»å³è¾¹åˆ é™¤nä¸ªç¬¦åˆvalue1çš„å€¼ï¼ˆä»å³åˆ°å·¦ï¼‰
    nä¸º0ï¼Œå°†åˆ—è¡¨ä¸­ç¬¦åˆvalue1çš„å€¼å…¨éƒ¨åˆ é™¤
ltrin key start end  <span class="token comment"># keyä¸­ä»…ä¿ç•™startåˆ°endçš„å…ƒç´ ï¼Œå…¶ä½™çš„ä¸¢å¼ƒï¼ˆç´¢å¼•ä»å·¦åˆ°å³ï¼‰</span></code></pre>
<h3 id="3ï¼‰Hash-å“ˆå¸Œè¡¨"><a href="#3ï¼‰Hash-å“ˆå¸Œè¡¨" class="headerlink" title="3ï¼‰Hash å“ˆå¸Œè¡¨"></a>3ï¼‰Hash å“ˆå¸Œè¡¨</h3><p>ç±»ä¼¼äºjavaçš„Map<String,String>ï¼Œå­—ç¬¦ä¸²é‡Œå¥—å­—ç¬¦ä¸²</p>
<ul>
<li>å¢åŠ å…ƒç´ ï¼š<code>hset key field vlaue</code>ã€<code>hmset key1 field1 value1 field2 value2</code> <ul>
<li>ä»…å½“fieldåŸŸä¸å­˜åœ¨æ—¶ï¼Œç»™keyé›†åˆä¸­fieldèµ‹å€¼value ï¼š<code>hsetnx key field value</code>                    </li>
</ul>
</li>
<li>æŸ¥è¯¢å…ƒç´ ï¼š<ul>
<li>è·å–key1ä¸­filed1æ‰€å¯¹åº”çš„çš„å€¼ï¼š<code>hget key1 field1</code></li>
<li>è·å–keyä¸­å…¨éƒ¨çš„å€¼ï¼š<code>hgetall key</code> </li>
<li>è·å–keyä¸­æ‰€æœ‰çš„valueæˆ–fieldï¼š<code>hvals key</code>ã€<code>hkeys key</code></li>
<li>æŸ¥è¯¢keyä¸­ï¼Œfield1åŸŸæ˜¯å¦å­˜åœ¨ï¼š<code>hexists key field1</code></li>
</ul>
</li>
<li>ç»™keyé›†åˆçš„åŸŸfieldçš„å€¼åŠ ä¸Šå¢é‡incrementï¼š<code>hincrby key field increment</code></li>
</ul>
<h3 id="4ï¼‰Set-é›†åˆ"><a href="#4ï¼‰Set-é›†åˆ" class="headerlink" title="4ï¼‰Set é›†åˆ"></a>4ï¼‰Set é›†åˆ</h3><ul>
<li>æ·»åŠ å…ƒç´ ï¼ˆè‹¥é‡å¤è‡ªåŠ¨å¿½ç•¥ï¼‰ï¼š<code>sadd key value1 value2...</code>  </li>
<li>åˆ é™¤å…ƒç´ ï¼š<code>srem key value1 value2</code>  </li>
<li>æŸ¥è¯¢æ‰€æœ‰å…ƒç´ ï¼š<code>smembers key</code> </li>
<li>æŸ¥è¯¢é›†åˆå…ƒç´ ä¸ªæ•°ï¼š<code>scard key</code></li>
<li>æŸ¥è¯¢å…ƒç´ æ˜¯å¦åœ¨é›†åˆä¸­ï¼š<code>sismember key value</code></li>
<li>éšæœºå–å€¼ï¼š<ul>
<li><code>spop key</code>    éšæœºå–å‡º1ä¸ªå€¼ï¼Œä¸ä¿ç•™</li>
<li><code>srandmember key n</code>     éšæœºå–å‡ºnä¸ªå€¼ï¼Œé›†åˆä¸­ä¿ç•™</li>
</ul>
</li>
<li>å–ä¸¤ä¸ªé›†åˆçš„äº¤é›†/å¹¶é›†/å·®é›†ï¼š<code>sinter/sunion/sdiff  key1  key2</code></li>
</ul>
<h3 id="5ï¼‰Zset-æœ‰åºé›†åˆ"><a href="#5ï¼‰Zset-æœ‰åºé›†åˆ" class="headerlink" title="5ï¼‰Zset æœ‰åºé›†åˆ"></a>5ï¼‰Zset æœ‰åºé›†åˆ</h3><p>Redisçš„Zsetå’ŒSetä¸€æ ·ï¼Œéƒ½æ˜¯Stringç±»å‹çš„é›†åˆï¼Œä¸”ä¸å…è®¸é‡å¤</p>
<p>ä¸åŒçš„æ˜¯ï¼ŒZsetæ¯ä¸ªå…ƒç´ éƒ½ä¼šå…³è”ä¸€ä¸ªdoubleç±»å‹çš„åˆ†æ•°ï¼›redisæ­£æ˜¯é€šè¿‡è¯¥åˆ†æ•°å¯¹é›†åˆä¸­çš„æˆå‘˜è¿›è¡Œä»å¤§åˆ°å°çš„æ’åºã€‚</p>
<p>Zsetä¸­æˆå‘˜æ˜¯å”¯ä¸€çš„ï¼Œä½†åˆ†æ•°å¯ä»¥é‡å¤ã€‚</p>
<ul>
<li>å¢åŠ å…ƒç´ ï¼š<code>zadd key score1 value1 score2 value2...</code></li>
<li>åˆ é™¤å…ƒç´ ï¼š<code>zrem key value</code></li>
<li>è·å–å…ƒç´ æ•°é‡ï¼š<code>zcard key</code></li>
<li>è·å–å…ƒç´ å¾—åˆ†ï¼š<code>zscore key member</code></li>
<li>è·å–å…ƒç´ å¾—åˆ†æ’åï¼š<code>zrank key value</code></li>
<li>è·å–å…ƒç´ ï¼š<ul>
<li>ä¸‹æ ‡åœ¨startå’Œstopä¹‹é—´çš„å…ƒç´ ï¼š<code>zrange key start stop withscores</code><ul>
<li>å¸¦withscoreså¯ä»¥è®©scoreå’Œvalueä¸€èµ·è¿”å›åˆ°ç»“æœé›†ï¼‰</li>
</ul>
</li>
<li>æ‰€æœ‰scoreå€¼ä»‹äº[min,max]çš„å…ƒç´ ï¼š<ul>
<li>å¾—åˆ†ä»å°åˆ°å¤§æ’åˆ—ï¼š<code>zrangebyscore key min max withscores</code></li>
<li>å¾—åˆ†ä»å¤§åˆ°å°æ’åˆ—ï¼š<code>zrevrangebyscore key max min withscores</code></li>
</ul>
</li>
</ul>
</li>
<li><p>ç»Ÿè®¡æŒ‡å®šå¾—åˆ†åŒºé—´ä¸­çš„å…ƒç´ ä¸ªæ•°ï¼š<code>zcount key min max</code></p>
</li>
<li><p>å…ƒç´ æ·»åŠ å¢é‡ï¼š<code>zincrby key increment value</code></p>
</li>
</ul>
<h3 id="6ï¼‰Geospatial-åœ°ç†ä½ç½®"><a href="#6ï¼‰Geospatial-åœ°ç†ä½ç½®" class="headerlink" title="6ï¼‰Geospatial åœ°ç†ä½ç½®"></a>6ï¼‰Geospatial åœ°ç†ä½ç½®</h3><h3 id="7ï¼‰Hyperloglog-åŸºæ•°ç»Ÿè®¡"><a href="#7ï¼‰Hyperloglog-åŸºæ•°ç»Ÿè®¡" class="headerlink" title="7ï¼‰Hyperloglog åŸºæ•°ç»Ÿè®¡"></a>7ï¼‰Hyperloglog åŸºæ•°ç»Ÿè®¡</h3><h3 id="8ï¼‰BitMaps-ä½å›¾"><a href="#8ï¼‰BitMaps-ä½å›¾" class="headerlink" title="8ï¼‰BitMaps ä½å›¾"></a>8ï¼‰BitMaps ä½å›¾</h3><h2 id="å››ã€äº‹åŠ¡"><a href="#å››ã€äº‹åŠ¡" class="headerlink" title="å››ã€äº‹åŠ¡"></a>å››ã€äº‹åŠ¡</h2><p>åŸå­æ€§Atomicï¼šè¿™ä¸€ç»„å‘½ä»¤è¦ä¹ˆä¸€èµ·æˆåŠŸï¼Œè¦ä¹ˆä¸€èµ·å¤±è´¥</p>
<p>ä¸€è‡´æ€§Consistencyï¼šäº‹åŠ¡å¿…é¡»ä½¿æ•°æ®åº“ä»ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€å˜æ¢åˆ°å¦ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€ã€‚æ¯”å¦‚Aè½¬ç»™B100å¿«ï¼Œæ— æ³•æˆåŠŸä¸å¦ï¼ŒAå’ŒBçš„æ€»é¢ä¸å˜ï¼Œæ•°æ®åº“çš„ä¸€è‡´æ€§çŠ¶æ€æ²¡æœ‰è¢«ç ´åã€‚</p>
<p>éš”ç¦»æ€§Isolationï¼š åœ¨å¹¶å‘æ•°æ®æ“ä½œæ—¶ï¼Œä¸åŒçš„äº‹åŠ¡æ‹¥æœ‰å„è‡ªçš„æ•°æ®ç©ºé—´ï¼Œç›¸äº’éš”ç¦»ã€‚</p>
<p>æŒä¹…æ€§Durabiliyï¼šä¸€æ—¦äº‹åŠ¡æäº¤æˆåŠŸåï¼Œäº‹åŠ¡ä¸­æ‰€æœ‰çš„æ•°æ®æ“ä½œéƒ½å¿…é¡»è¢«æŒä¹…åŒ–åˆ°æ•°æ®åº“ä¸­ã€‚å³ä½¿åœ¨äº‹åŠ¡æäº¤åï¼Œæ•°æ®åº“é©¬ä¸Šå´©æºƒï¼Œåœ¨æ•°æ®åº“é‡å¯æ—¶ï¼Œä¹Ÿå¿…é¡»ä¿è¯èƒ½å¤Ÿé€šè¿‡æŸç§æœºåˆ¶æ¢å¤æ•°æ®ã€‚</p>
<h3 id="1ï¼‰Redisäº‹åŠ¡æ“ä½œè¿‡ç¨‹"><a href="#1ï¼‰Redisäº‹åŠ¡æ“ä½œè¿‡ç¨‹" class="headerlink" title="1ï¼‰Redisäº‹åŠ¡æ“ä½œè¿‡ç¨‹"></a>1ï¼‰Redisäº‹åŠ¡æ“ä½œè¿‡ç¨‹</h3><ul>
<li>å¼€å¯äº‹åŠ¡ï¼š<code>multi</code></li>
<li>å‘½ä»¤å…¥é˜Ÿ</li>
<li><p>æ‰§è¡Œäº‹åŠ¡ï¼š<code>exec</code></p>
<ul>
<li>äº‹åŠ¡ä¸­çš„å‘½ä»¤åœ¨åŠ å…¥æ—¶ï¼Œå¹¶ä¸ä¼šç«‹å³æ‰§è¡Œï¼›åªæœ‰æäº¤æ—¶ï¼Œæ‰ä¼šä¸€æ¬¡æ€§æ‰§è¡Œå®Œ</li>
</ul>
</li>
<li><p>å–æ¶ˆäº‹åŠ¡ï¼š<code>discard</code></p>
</li>
</ul>
<h3 id="2ï¼‰äº‹åŠ¡å‘ç”Ÿé”™è¯¯"><a href="#2ï¼‰äº‹åŠ¡å‘ç”Ÿé”™è¯¯" class="headerlink" title="2ï¼‰äº‹åŠ¡å‘ç”Ÿé”™è¯¯"></a>2ï¼‰äº‹åŠ¡å‘ç”Ÿé”™è¯¯</h3><ul>
<li><p>ä»£ç è¯­æ³• é”™è¯¯ï¼Œæ‰€æœ‰å‘½ä»¤å‡ä¸æ‰§è¡Œ â€”&gt;  ç¬¦åˆåŸå­æ€§</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> multi
OK
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> <span class="token builtin class-name">set</span> k1 v1
QUEUED
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> <span class="token builtin class-name">set</span> k2 v2
QUEUED
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> error k1 <span class="token comment"># è¿™æ˜¯ä¸€æ¡è¯­æ³•é”™è¯¯å‘½ä»¤</span>
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> ERR unknown <span class="token builtin class-name">command</span> <span class="token variable"><span class="token variable">`</span>error<span class="token variable">`</span></span>, with args beginning with: <span class="token variable"><span class="token variable">`</span>k1<span class="token variable">`</span></span>, <span class="token comment"># ä¼šæŠ¥é”™ä½†æ˜¯ä¸å½±å“åç»­å‘½ä»¤å…¥é˜Ÿ </span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> get k2
QUEUED
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> EXEC
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> EXECABORT Transaction discarded because of previous errors. <span class="token comment"># æ‰§è¡ŒæŠ¥é”™</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> get k1 
<span class="token punctuation">(</span>nil<span class="token punctuation">)</span>    s<span class="token comment"># å…¶ä»–å‘½ä»¤å¹¶æ²¡æœ‰è¢«æ‰§è¡Œ</span></code></pre>
</li>
<li><p>ä»£ç é€»è¾‘ é”™è¯¯ï¼Œéƒ¨åˆ†å‘½ä»¤å¯ä»¥æ‰§è¡Œ  â€“&gt;  ä¸ç¬¦åˆåŸå­æ€§</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> multi
OK
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> <span class="token builtin class-name">set</span> k1 v1
QUEUED
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> <span class="token builtin class-name">set</span> k2 v2
QUEUED
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> INCR k1 <span class="token comment"># è¿™æ¡å‘½ä»¤é€»è¾‘é”™è¯¯ï¼ˆå¯¹å­—ç¬¦ä¸²è¿›è¡Œå¢é‡ï¼‰</span>
QUEUED
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> get k2
QUEUED
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> <span class="token builtin class-name">exec</span>
<span class="token number">1</span><span class="token punctuation">)</span> OK
<span class="token number">2</span><span class="token punctuation">)</span> OK
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> ERR value is not an integer or out of range <span class="token comment"># è¿è¡Œæ—¶æŠ¥é”™</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"v2"</span> <span class="token comment"># å…¶ä»–å‘½ä»¤æ­£å¸¸æ‰§è¡Œ</span></code></pre>
</li>
<li><p>æ€»ç»“ï¼šå•ä¸ª Redis å‘½ä»¤çš„æ‰§è¡Œæ˜¯åŸå­æ€§çš„ï¼Œä½† Redis æ²¡æœ‰åœ¨äº‹åŠ¡ä¸Šå¢åŠ ä»»ä½•ç»´æŒåŸå­æ€§çš„æœºåˆ¶ï¼Œæ‰€ä»¥ Redis<br>äº‹åŠ¡çš„æ‰§è¡Œå¹¶ä¸æ˜¯åŸå­æ€§çš„ã€‚ æ‰€ä»¥æ”¶åˆ° EXEC å‘½ä»¤åè¿›å…¥äº‹åŠ¡æ‰§è¡Œï¼Œäº‹åŠ¡ä¸­ä»»æ„å‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼Œå…¶ä½™çš„å‘½ä»¤ä¾ç„¶è¢«æ‰§è¡Œã€‚</p>
</li>
</ul>
<h3 id="3ï¼‰ä¹è§‚é”ä¸æ‚²è§‚é”"><a href="#3ï¼‰ä¹è§‚é”ä¸æ‚²è§‚é”" class="headerlink" title="3ï¼‰ä¹è§‚é”ä¸æ‚²è§‚é”"></a>3ï¼‰ä¹è§‚é”ä¸æ‚²è§‚é”</h3><ul>
<li>æ‚²è§‚é”ï¼šå¾ˆæ‚²è§‚ï¼Œè®¤ä¸ºä»€ä¹ˆæ—¶å€™éƒ½ä¼šå‡ºç°é—®é¢˜ï¼Œæ— è®ºåšä»€ä¹ˆéƒ½è¦åŠ é”</li>
<li>ä¹è§‚é”ï¼šå¾ˆä¹è§‚ï¼Œè®¤ä¸ºä»€ä¹ˆæ—¶å€™éƒ½ä¸ä¼šå‡ºç°é—®é¢˜ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”ï¼æ›´æ–°æ•°æ®çš„æ—¶å€™å»åˆ¤æ–­ä¸€ä¸‹ï¼Œåœ¨æ­¤æœŸé—´æ˜¯å¦æœ‰äººä¿®æ”¹è¿‡è¿™ä¸ªæ•°æ®</li>
</ul>
<p>Redisé‡‡ç”¨çš„æ˜¯ä¹è§‚é”ï¼Œå¯é‡‡ç”¨<code>watch key</code>ç›‘æ§æŒ‡å®šæ•°æ®ï¼Œç›¸å½“äºä¹è§‚é”åŠ é”ï¼›</p>
<p>æ¯æ¬¡execæ—¶ï¼Œæ— æ³•æˆåŠŸä¸å¦ï¼Œéƒ½æ˜¯è‡ªåŠ¨é‡Šæ”¾é”ï¼›ä¹Ÿå¯é‡‡ç”¨<code>unwatch key</code>æ‰‹åŠ¨è§£é”</p>
<h2 id="äº”ã€Jedis"><a href="#äº”ã€Jedis" class="headerlink" title="äº”ã€Jedis"></a>äº”ã€Jedis</h2><p>Jedisæ˜¯Rediså®˜æ–¹æ¨èä½¿ç”¨çš„Javaè¿æ¥redisçš„å®¢æˆ·ç«¯</p>
<h3 id="1ï¼‰Hello"><a href="#1ï¼‰Hello" class="headerlink" title="1ï¼‰Hello"></a>1ï¼‰Hello</h3><p>å¯¼å…¥ä¾èµ–</p>
<pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token comment">&lt;!--å¯¼å…¥jredisçš„åŒ…--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>redis.clients<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>jedis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.2.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
<span class="token comment">&lt;!--fastjson--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>fastjson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.2.70<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre>
<p>æµ‹è¯•</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestPing</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">"192.168.xx.xxx"</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> response <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">ping</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// PONG</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>
<h3 id="2ï¼‰äº‹åŠ¡"><a href="#2ï¼‰äº‹åŠ¡" class="headerlink" title="2ï¼‰äº‹åŠ¡"></a>2ï¼‰äº‹åŠ¡</h3><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestTX</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">"39.99.xxx.xx"</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">JSONObject</span> jsonObject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSONObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jsonObject<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span> <span class="token string">"world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jsonObject<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"kuangshen"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        
        <span class="token class-name">Transaction</span> multi <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">multi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// å¼€å¯äº‹åŠ¡</span>
        <span class="token class-name">String</span> result <span class="token operator">=</span> jsonObject<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// jedis.watch(result)</span>
        
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            multi<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"user1"</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
            multi<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"user2"</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
            multi<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// æ‰§è¡Œäº‹åŠ¡</span>
        <span class="token punctuation">&#125;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            
            multi<span class="token punctuation">.</span><span class="token function">discard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// æ”¾å¼ƒäº‹åŠ¡</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>            
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"user1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"user2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// å…³é—­è¿æ¥</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>
<h2 id="å…­ã€å’ŒSpringBootæ•´åˆ"><a href="#å…­ã€å’ŒSpringBootæ•´åˆ" class="headerlink" title="å…­ã€å’ŒSpringBootæ•´åˆ"></a>å…­ã€å’ŒSpringBootæ•´åˆ</h2><p>springboot 2.xå ï¼ŒåŸæ¥ä½¿ç”¨çš„ <code>Jedis</code> è¢« <code>lettuce</code> æ›¿æ¢ã€‚</p>
<ul>
<li>jedisï¼šé‡‡ç”¨<strong>ç›´è¿</strong>ï¼Œå¤šä¸ªçº¿ç¨‹æ“ä½œæ—¶ï¼Œä¸å®‰å…¨ã€‚å¦‚æœè¦é¿å…ä¸å®‰å…¨ï¼Œéœ€è¦ä½¿ç”¨jedis poolè¿æ¥æ± ï¼æ›´åƒBIOæ¨¡å¼</li>
<li>lettuceï¼šé‡‡ç”¨<strong>netty</strong>ï¼Œå®ä¾‹å¯ä»¥åœ¨å¤šä¸ªçº¿ç¨‹ä¸­å…±äº«ï¼Œçº¿ç¨‹æ›´å®‰å…¨ï¼å¯ä»¥å‡å°‘çº¿ç¨‹æ•°æ®äº†ï¼Œæ›´åƒNIOæ¨¡å¼</li>
</ul>
<p>âš¡ å¯¼å…¥ä¾èµ–</p>
<pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre>
<p>âš¡ é…ç½®application.properties</p>
<pre class="language-properties" data-language="properties"><code class="language-properties"><span class="token attr-name">spring.redis.host</span><span class="token punctuation">=</span><span class="token attr-value">127.0.0.1</span>
<span class="token attr-name">spring.redis.port</span><span class="token punctuation">=</span><span class="token attr-value">6379</span></code></pre>
<p>âš¡ æµ‹è¯•</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>gaowl<span class="token punctuation">.</span>redis02springboot</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">SpringBootTest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>connection<span class="token punctuation">.</span></span><span class="token class-name">RedisConnection</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">RedisTemplate</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Arrays</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Comparator</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">class</span> <span class="token class-name">Redis02SpringbootApplicationTests</span> <span class="token punctuation">&#123;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisTemplate</span> redisTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">contextLoads</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// redisTemplate æ“ä½œä¸åŒçš„æ•°æ®ç±»å‹ï¼Œapiå’Œæˆ‘ä»¬çš„æŒ‡ä»¤æ˜¯ä¸€æ ·çš„</span>
        <span class="token comment">// opsForValue æ“ä½œå­—ç¬¦ä¸² ç±»ä¼¼String</span>
        <span class="token comment">// opsForList æ“ä½œList ç±»ä¼¼List</span>
        <span class="token comment">// opsForSet</span>
        <span class="token comment">// opsForHash</span>
        <span class="token comment">// opsForZSet</span>
        <span class="token comment">// opsForGeo</span>
        <span class="token comment">// opsForHyperLogLog</span>

        redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"TestRedis"</span><span class="token punctuation">,</span><span class="token string">"aaa"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"TestRedis"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>
<h2 id="å…­ã€é…ç½®æ–‡ä»¶redis-conf"><a href="#å…­ã€é…ç½®æ–‡ä»¶redis-conf" class="headerlink" title="å…­ã€é…ç½®æ–‡ä»¶redis.conf"></a>å…­ã€é…ç½®æ–‡ä»¶redis.conf</h2><ul>
<li><p>unitå•ä½</p>
</li>
<li><p>åŒ…å«é…ç½®æ–‡ä»¶çš„è·¯å¾„</p>
</li>
<li><p>ç½‘ç»œ</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">bind</span> <span class="token number">127.0</span>.0.1 <span class="token comment"># ç»‘å®šçš„ip</span>
protected-mode <span class="token function">yes</span> <span class="token comment"># ä¿æŠ¤æ¨¡å¼</span>
port <span class="token number">6379</span> <span class="token comment"># ç«¯å£è®¾ç½®</span></code></pre>
</li>
<li><p>é€šç”¨</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">daemonize <span class="token function">yes</span> <span class="token comment"># ä»¥å®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼è¿è¡Œï¼Œé»˜è®¤æ˜¯ noï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±å¼€å¯ä¸ºyesï¼</span>
pidfile /var/run/redis_6379.pid <span class="token comment"># å¦‚æœä»¥åå°çš„æ–¹å¼è¿è¡Œï¼Œæˆ‘ä»¬å°±éœ€è¦æŒ‡å®šä¸€ä¸ª pid æ–‡ä»¶ï¼</span>
<span class="token comment"># æ—¥å¿—</span>
<span class="token comment"># Specify the server verbosity level.</span>
<span class="token comment"># This can be one of:</span>
<span class="token comment"># debug (a lot of information, useful for development/testing)</span>
<span class="token comment"># verbose (many rarely useful info, but not a mess like the debug level)</span>
<span class="token comment"># notice (moderately verbose, what you want in production probably) ç”Ÿäº§ç¯å¢ƒ</span>
<span class="token comment"># warning (only very important / critical messages are logged)</span>
loglevel notice
logfile <span class="token string">""</span> <span class="token comment"># æ—¥å¿—çš„æ–‡ä»¶ä½ç½®å</span>
databases <span class="token number">16</span> <span class="token comment"># æ•°æ®åº“çš„æ•°é‡ï¼Œé»˜è®¤æ˜¯ 16 ä¸ªæ•°æ®åº“</span>
always-show-logo <span class="token function">yes</span> <span class="token comment"># æ˜¯å¦æ€»æ˜¯æ˜¾ç¤ºLOGO</span></code></pre>
</li>
<li><p>RDBå¿«ç…§</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å¦‚æœ900så†…ï¼Œå¦‚æœè‡³å°‘æœ‰ä¸€ä¸ª1 keyè¿›è¡Œäº†ä¿®æ”¹ï¼Œæˆ‘ä»¬åŠè¿›è¡ŒæŒä¹…åŒ–æ“ä½œ</span>
save <span class="token number">900</span> <span class="token number">1</span>
<span class="token comment"># å¦‚æœ300så†…ï¼Œå¦‚æœè‡³å°‘10 keyè¿›è¡Œäº†ä¿®æ”¹ï¼Œæˆ‘ä»¬åŠè¿›è¡ŒæŒä¹…åŒ–æ“ä½œ</span>
save <span class="token number">300</span> <span class="token number">10</span>
<span class="token comment"># å¦‚æœ60så†…ï¼Œå¦‚æœè‡³å°‘10000 keyè¿›è¡Œäº†ä¿®æ”¹ï¼Œæˆ‘ä»¬åŠè¿›è¡ŒæŒä¹…åŒ–æ“ä½œ</span>
save <span class="token number">60</span> <span class="token number">10000</span>

stop-writes-on-bgsave-error <span class="token function">yes</span> <span class="token comment"># æŒä¹…åŒ–å¦‚æœå‡ºé”™ï¼Œæ˜¯å¦è¿˜éœ€è¦ç»§ç»­å·¥ä½œï¼</span>
rdbcompression <span class="token function">yes</span> <span class="token comment"># æ˜¯å¦å‹ç¼© rdb æ–‡ä»¶ï¼Œéœ€è¦æ¶ˆè€—ä¸€äº›cpuèµ„æºï¼</span>
rdbchecksum <span class="token function">yes</span> <span class="token comment"># ä¿å­˜rdbæ–‡ä»¶çš„æ—¶å€™ï¼Œè¿›è¡Œé”™è¯¯çš„æ£€æŸ¥æ ¡éªŒï¼</span>
<span class="token function">dir</span> ./ <span class="token comment"># rdb æ–‡ä»¶ä¿å­˜çš„ç›®å½•ï¼</span></code></pre>
</li>
<li><p>AOFé…ç½®</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">appendonly no <span class="token comment"># é»˜è®¤æ˜¯ä¸å¼€å¯aofæ¨¡å¼çš„ï¼Œé»˜è®¤æ˜¯ä½¿ç”¨rdbæ–¹å¼æŒä¹…åŒ–çš„ï¼Œåœ¨å¤§éƒ¨åˆ†æ‰€æœ‰çš„æƒ…å†µä¸‹ï¼Œrdbå®Œå…¨å¤Ÿç”¨ï¼</span>
appendfilename <span class="token string">"appendonly.aof"</span> <span class="token comment"># æŒä¹…åŒ–çš„æ–‡ä»¶çš„åå­—</span>
<span class="token comment"># appendfsync always # æ¯æ¬¡ä¿®æ”¹éƒ½ä¼š syncã€‚æ¶ˆè€—æ€§èƒ½</span>
appendfsync everysec <span class="token comment"># æ¯ç§’æ‰§è¡Œä¸€æ¬¡ syncï¼Œå¯èƒ½ä¼šä¸¢å¤±è¿™1sçš„æ•°æ®ï¼</span>
<span class="token comment"># appendfsync no # ä¸æ‰§è¡Œ syncï¼Œè¿™ä¸ªæ—¶å€™æ“ä½œç³»ç»Ÿè‡ªå·±åŒæ­¥æ•°æ®ï¼Œé€Ÿåº¦æœ€å¿«ï¼</span></code></pre>
</li>
<li><p>é™åˆ¶å®¢æˆ·ç«¯</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">maxclients <span class="token number">10000</span> <span class="token comment"># è®¾ç½®èƒ½è¿æ¥ä¸Šredisçš„æœ€å¤§å®¢æˆ·ç«¯çš„æ•°é‡</span>
maxmemory <span class="token operator">&lt;</span>bytes<span class="token operator">></span> <span class="token comment"># redis é…ç½®æœ€å¤§çš„å†…å­˜å®¹é‡</span>
maxmemory-policy noeviction <span class="token comment"># å†…å­˜åˆ°è¾¾ä¸Šé™ä¹‹åçš„å¤„ç†ç­–ç•¥</span>
    <span class="token number">1</span>ã€volatile-lruï¼šåªå¯¹è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„keyè¿›è¡ŒLRUï¼ˆé»˜è®¤å€¼ï¼‰
    <span class="token number">2</span>ã€allkeys-lru ï¼š åˆ é™¤lruç®—æ³•çš„key
    <span class="token number">3</span>ã€volatile-randomï¼šéšæœºåˆ é™¤å³å°†è¿‡æœŸkey
    <span class="token number">4</span>ã€allkeys-randomï¼šéšæœºåˆ é™¤
    <span class="token number">5</span>ã€volatile-ttl ï¼š åˆ é™¤å³å°†è¿‡æœŸçš„
    <span class="token number">6</span>ã€noeviction ï¼š æ°¸ä¸è¿‡æœŸï¼Œè¿”å›é”™è¯¯</code></pre>
</li>
</ul>
<h2 id="ä¸ƒã€æŒä¹…åŒ–"><a href="#ä¸ƒã€æŒä¹…åŒ–" class="headerlink" title="ä¸ƒã€æŒä¹…åŒ–"></a>ä¸ƒã€æŒä¹…åŒ–</h2><p>Rediså°†æ•°æ®ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œå¦‚æœä¸åŠæ—¶å°†å†…å­˜ä¸­çš„æ•°æ®åº“çŠ¶æ€ä¿å­˜åˆ°ç£ç›˜ä¸­ï¼Œé‚£ä¹ˆä¸€æ—¦æœåŠ¡å™¨è¿›ç¨‹é€€å‡ºï¼ŒæœåŠ¡å™¨ä¸­<br>çš„æ•°æ®åº“çŠ¶æ€ä¹Ÿä¼šæ¶ˆå¤±ã€‚</p>
<h3 id="1ï¼‰RDBï¼ˆRedis-DataBaseï¼‰"><a href="#1ï¼‰RDBï¼ˆRedis-DataBaseï¼‰" class="headerlink" title="1ï¼‰RDBï¼ˆRedis DataBaseï¼‰"></a>1ï¼‰RDBï¼ˆRedis DataBaseï¼‰</h3><p>åœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…ï¼Œå°†å†…å­˜ä¸­çš„æ•°æ®å¿«ç…§ï¼ˆsnapshotï¼‰å†™å…¥ç£ç›˜ä¸­ã€‚æ¢å¤æ—¶ï¼Œç›´æ¥å°†å¿«ç…§æ–‡ä»¶è¯»åˆ°å†…å­˜é‡Œå³å¯ã€‚</p>
<p><img src="https://hexo-blog-1254804803.cos.ap-shanghai.myqcloud.com/img/20210129144337.jpg" srcset="/img/loading.gif" alt=""></p>
<p>Rediså•ç‹¬åˆ›å»ºï¼ˆforkï¼‰ä¸€ä¸ªå­è¿›ç¨‹æ¥è¿›è¡Œæ•°æ®æŒä¹…åŒ–ï¼Œå…¶å…ˆå°†æ•°æ®å†™å…¥åˆ°ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œå¾…æŒä¹…åŒ–è¿‡ç¨‹éƒ½ç»“æŸäº†ï¼Œå†ç”¨è¿™ä¸ªä¸´æ—¶æ–‡ä»¶æ›¿æ¢ä¸Šæ¬¡æŒä¹…åŒ–å¥½çš„æ–‡ä»¶ã€‚æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¸»è¿›ç¨‹æ˜¯ä¸è¿›è¡Œä»»ä½•IOæ“ä½œçš„ã€‚</p>
<p>RDBé»˜è®¤ä¿å­˜çš„æ–‡ä»¶åä¸º<code>dump.rdb</code>ï¼Œå¯ä»¥åœ¨é…ç½®æ–‡ä»¶<code>redis.conf</code>ä¸­ä¿®æ”¹</p>
<p>ğŸŒ saveè§„åˆ™ä»‹ç»ï¼š</p>
<ul>
<li><code>save 900 1</code>ï¼š900ç§’å†…ä¿®æ”¹äº†ä¸€æ¬¡keyï¼Œè§¦å‘RDBæ“ä½œ</li>
<li><code>save 300 10</code>ï¼š300ç§’å†…ä¿®æ”¹äº†10æ¬¡keyï¼Œè§¦å‘RDBæ“ä½œ</li>
<li><code>save 600 10000</code>ï¼š600ç§’å†…ä¿®æ”¹äº†10000keyï¼Œè§¦å‘RDBæ“ä½œ</li>
</ul>
<p>ğŸŒ RDBè§¦å‘æœºåˆ¶ï¼š</p>
<ul>
<li>saveçš„è§„åˆ™æ»¡è¶³çš„æƒ…å†µä¸‹ï¼Œä¼šè‡ªåŠ¨è§¦å‘rdbè§„åˆ™</li>
<li>æ‰§è¡Œ flushall å‘½ä»¤ï¼Œä¹Ÿä¼šè§¦å‘æˆ‘ä»¬çš„rdbè§„åˆ™ï¼</li>
<li>é€€å‡ºredisï¼Œä¹Ÿä¼šäº§ç”Ÿ rdb æ–‡ä»¶ï¼</li>
</ul>
<p>ğŸŒ å¦‚ä½•ä»dump.rdbä¸­æ¢å¤ï¼š</p>
<ul>
<li>åªéœ€è¦å°†rdbæ–‡ä»¶æ”¾åœ¨rediså¯åŠ¨ç›®å½•ä¸‹ï¼Œå½“rediså¯åŠ¨æ—¶ï¼Œä¼šè‡ªåŠ¨æ£€æŸ¥dump.rdb å¹¶æ¢å¤å…¶ä¸­<br>çš„æ•°æ®ï¼</li>
<li>rdbæ–‡ä»¶çš„è·¯å¾„å¯åœ¨é…ç½®æ–‡ä»¶<code>redis.conf</code>ä¸­ä¿®æ”¹</li>
</ul>
<p>ğŸŒ ä¼˜ç¼ºç‚¹ï¼š</p>
<ul>
<li>é€‚åˆå¤§è§„æ¨¡çš„æ•°æ®æ¢å¤ï¼Œé€Ÿåº¦å¿«é«˜æ•ˆï¼›Redisé»˜è®¤çš„æŒä¹…åŒ–å·¥å…·</li>
<li>éœ€è¦ä¸€å®šçš„æ—¶é—´é—´éš”è¿›ç¨‹æ“ä½œï¼Œå¦‚æœredisæ„å¤–å®•æœºäº†ï¼Œæœ€åä¸€æ¬¡ä¿®æ”¹çš„æ•°æ®å°±ä¸¢å¤±äº†ï¼›forkè¿›ç¨‹çš„æ—¶å€™ï¼Œä¹Ÿä¼šå ç”¨ä¸€å®šçš„å†…å®¹ç©ºé—´</li>
</ul>
<h3 id="2ï¼‰AOFï¼ˆAppend-Only-Fifeï¼‰"><a href="#2ï¼‰AOFï¼ˆAppend-Only-Fifeï¼‰" class="headerlink" title="2ï¼‰AOFï¼ˆAppend Only Fifeï¼‰"></a>2ï¼‰AOFï¼ˆAppend Only Fifeï¼‰</h3><p>ä»¥æ—¥å¿—çš„å½¢å¼æ¥è®°å½•æ¯ä¸ª<strong>å†™æ“ä½œ</strong>ï¼Œrediså¯åŠ¨æ—¶ï¼Œæ‰§è¡Œæ—¥å¿—æ–‡ä»¶ä¸­çš„å†™å‘½ä»¤ä»¥å®Œæˆæ•°æ®çš„æ¢å¤å·¥ä½œã€‚</p>
<p><img src="https://hexo-blog-1254804803.cos.ap-shanghai.myqcloud.com/img/20210129150223.jpg" srcset="/img/loading.gif" alt=""></p>
<p>AOFé»˜è®¤ä¸å¼€å¯ï¼Œå…¶ä¿å­˜çš„æ–‡ä»¶é»˜è®¤åç§°ä¸º <code>appendonly.aof</code> ï¼Œé»˜è®¤æ— é™è¿½åŠ æŒ‡ä»¤ï¼›</p>
<p>å½“<code>appendonly.aof</code>æŸåæ—¶ï¼Œå¯é€šè¿‡<code>redis-check-aof --fix appendonly.aof</code>å¯¹æ–‡ä»¶è¿›è¡Œä¿®å¤</p>
<p>ä¼˜ç¼ºç‚¹ï¼š</p>
<ul>
<li><p>AOFæ–‡ä»¶ä¿å­˜çš„æ•°æ®é›†è¦æ¯”RDBæ–‡ä»¶ä¿å­˜çš„æ•°æ®é›†è¦å®Œæ•´</p>
</li>
<li><p>AOFæ•°æ®æ–‡ä»¶å ç”¨å†…å­˜è¿œè¿œå¤§äº rdbï¼Œä¿®å¤çš„é€Ÿåº¦ä¹Ÿæ¯” rdbæ…¢ï¼Œè¿è¡Œæ•ˆç‡ä¹Ÿè¦æ¯” rdb æ…¢</p>
</li>
</ul>
<h3 id="3ï¼‰æ€»ç»“"><a href="#3ï¼‰æ€»ç»“" class="headerlink" title="3ï¼‰æ€»ç»“"></a>3ï¼‰æ€»ç»“</h3><ul>
<li>RDB æŒä¹…åŒ–æ˜¯åœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…å¯¹æ•°æ®åº“è¿›è¡Œå¿«ç…§å­˜å‚¨ï¼›è€ŒAOF æŒä¹…åŒ–æ–¹å¼è®°å½•æ¯æ¬¡å¯¹æœåŠ¡å™¨å†™çš„æ“ä½œï¼Œå½“æœåŠ¡å™¨é‡å¯çš„æ—¶å€™ä¼šé‡æ–°æ‰§è¡Œè¿™äº›å‘½ä»¤æ¥æ¢å¤åŸå§‹çš„æ•°æ®ï¼ŒAOFå‘½ä»¤ä»¥Redis åè®®è¿½åŠ ä¿å­˜æ¯æ¬¡å†™çš„æ“ä½œåˆ°æ–‡ä»¶æœ«å°¾ï¼ŒRedisè¿˜èƒ½å¯¹AOFæ–‡ä»¶è¿›è¡Œåå°é‡å†™ï¼Œä½¿å¾—AOFæ–‡ä»¶çš„ä½“ç§¯ä¸è‡³äºè¿‡å¤§ã€‚</li>
<li>åŒæ—¶å¼€å¯ä¸¤ç§æŒä¹…åŒ–æ–¹å¼ï¼š<ul>
<li>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå½“redisé‡å¯çš„æ—¶å€™ä¼š<strong>ä¼˜å…ˆè½½å…¥AOFæ–‡ä»¶</strong>æ¥æ¢å¤åŸå§‹çš„æ•°æ®ï¼Œå› ä¸ºåœ¨é€šå¸¸æƒ…å†µä¸‹AOF<br>æ–‡ä»¶ä¿å­˜çš„æ•°æ®é›†è¦æ¯”RDBæ–‡ä»¶ä¿å­˜çš„æ•°æ®é›†è¦å®Œæ•´ã€‚</li>
<li>å¦‚æœEnable AOF ï¼Œå¥½å¤„æ˜¯åœ¨æœ€æ¶åŠ£æƒ…å†µä¸‹ä¹Ÿåªä¼šä¸¢å¤±ä¸è¶…è¿‡ä¸¤ç§’æ•°æ®ï¼Œå¯åŠ¨è„šæœ¬è¾ƒç®€å•ï¼Œåªloadè‡ªå·±çš„AOFæ–‡ä»¶å°±å¯ä»¥äº†ï¼Œä»£ä»·ä¸€æ˜¯å¸¦æ¥äº†æŒç»­çš„IOï¼ŒäºŒæ˜¯AOF rewrite çš„æœ€åå°† rewrite è¿‡ç¨‹ä¸­äº§ç”Ÿçš„æ–°æ•°æ®å†™åˆ°æ–°æ–‡ä»¶é€ æˆçš„é˜»å¡å‡ ä¹æ˜¯ä¸å¯é¿å…çš„ã€‚åªè¦ç¡¬ç›˜è®¸å¯ï¼Œåº”è¯¥å°½é‡å‡å°‘AOF rewriteçš„é¢‘ç‡ï¼ŒAOFé‡å†™çš„åŸºç¡€å¤§å°é»˜è®¤å€¼64Må¤ªå°äº†ï¼Œå¯ä»¥è®¾åˆ°5Gä»¥ä¸Šï¼Œé»˜è®¤è¶…è¿‡åŸå¤§å°100%å¤§å°é‡å†™å¯ä»¥æ”¹åˆ°é€‚å½“çš„æ•°å€¼ã€‚</li>
<li>å¦‚æœä¸Enable AOF ï¼Œä»…é  Master-Slave Repllcation å®ç°é«˜å¯ç”¨æ€§ä¹Ÿå¯ä»¥ï¼Œèƒ½çœæ‰ä¸€å¤§ç¬”IOï¼Œä¹Ÿå‡å°‘äº†rewriteæ—¶å¸¦æ¥çš„ç³»ç»Ÿæ³¢åŠ¨ã€‚ä»£ä»·æ˜¯å¦‚æœMaster/Slave åŒæ—¶å€’æ‰ï¼Œä¼šä¸¢å¤±åå‡ åˆ†é’Ÿçš„æ•°æ®ï¼Œå¯åŠ¨è„šæœ¬ä¹Ÿè¦æ¯”è¾ƒä¸¤ä¸ª Master/Slave ä¸­çš„ RDBæ–‡ä»¶ï¼Œè½½å…¥è¾ƒæ–°çš„é‚£ä¸ªï¼Œå¾®åšå°±æ˜¯è¿™ç§æ¶æ„ã€‚</li>
</ul>
</li>
</ul>
<h2 id="å…«ã€å‘å¸ƒå’Œè®¢é˜…"><a href="#å…«ã€å‘å¸ƒå’Œè®¢é˜…" class="headerlink" title="å…«ã€å‘å¸ƒå’Œè®¢é˜…"></a>å…«ã€å‘å¸ƒå’Œè®¢é˜…</h2><p>Redis å‘å¸ƒè®¢é˜…(pub/sub)æ˜¯ä¸€ç§æ¶ˆæ¯é€šä¿¡æ¨¡å¼ï¼šå‘é€è€…(pub)å‘é€æ¶ˆæ¯ï¼Œè®¢é˜…è€…(sub)æ¥æ”¶æ¶ˆæ¯ã€‚</p>
<p><img src="https://hexo-blog-1254804803.cos.ap-shanghai.myqcloud.com/img/20210129151507.jpg" srcset="/img/loading.gif" alt=""></p>
<p>å¸¸ç”¨çš„å‘½ä»¤ï¼š</p>
<ul>
<li><code>psubscribe pattern [pattern]</code>ï¼šè®¢é˜…ä¸€ä¸ªæˆ–è€…å¤šä¸ªç¬¦åˆç»™å®šæ¨¡å¼çš„é¢‘é“</li>
<li><p><code>punsubscribe pattern [pattern]</code>ï¼šé€€è®¢é¢‘é“</p>
</li>
<li><p><code>publish channel message</code>ï¼šå°†æ¶ˆæ¯å‘é€åˆ°æŒ‡å®šçš„é¢‘é“</p>
</li>
<li><code>subscribe channel [channel]</code>ï¼šè®¢é˜…ç»™å®šçš„ä¸€ä¸ªæˆ–è€…å¤šä¸ªé¢‘é“çš„æ¶ˆæ¯</li>
<li><code>unsubscribe channel [channel]</code>ï¼šé€€è®¢é¢‘é“</li>
</ul>
<p>è®¢é˜…ç«¯</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> SUBSCRIBE kuangshenshuo <span class="token comment"># è®¢é˜…ä¸€ä¸ªé¢‘é“ kuangshenshuo</span>
Reading messages<span class="token punctuation">..</span>. <span class="token punctuation">(</span>press Ctrl-C to quit<span class="token punctuation">)</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"subscribe"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"kuangshenshuo"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token comment"># ç­‰å¾…è¯»å–æ¨é€çš„ä¿¡æ¯</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"message"</span> <span class="token comment"># æ¶ˆæ¯</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"kuangshenshuo"</span> <span class="token comment"># é‚£ä¸ªé¢‘é“çš„æ¶ˆæ¯</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"hello,kuangshen"</span> <span class="token comment"># æ¶ˆæ¯çš„å…·ä½“å†…å®¹</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"message"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"kuangshenshuo"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"hello,redis"</span></code></pre>
<p>å‘é€ç«¯</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> PUBLISH kuangshenshuo <span class="token string">"hello,kuangshen"</span> <span class="token comment"># å‘å¸ƒè€…å‘å¸ƒæ¶ˆæ¯åˆ°é¢‘é“ï¼</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> PUBLISH kuangshenshuo <span class="token string">"hello,redis"</span> <span class="token comment"># å‘å¸ƒè€…å‘å¸ƒæ¶ˆæ¯åˆ°é¢‘é“ï¼</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span></code></pre>
<h2 id="ä¹ã€ä¸»ä»å¤åˆ¶"><a href="#ä¹ã€ä¸»ä»å¤åˆ¶" class="headerlink" title="ä¹ã€ä¸»ä»å¤åˆ¶"></a>ä¹ã€ä¸»ä»å¤åˆ¶</h2><h3 id="1ï¼‰æ¦‚è¿°-1"><a href="#1ï¼‰æ¦‚è¿°-1" class="headerlink" title="1ï¼‰æ¦‚è¿°"></a>1ï¼‰æ¦‚è¿°</h3><p>ä¸»ä»å¤åˆ¶ï¼Œæ˜¯æŒ‡å°†ä¸€å°RedisæœåŠ¡å™¨çš„æ•°æ®ï¼Œå¤åˆ¶åˆ°å…¶ä»–çš„RedisæœåŠ¡å™¨ã€‚</p>
<ul>
<li>å‰è€…ç§°ä¸ºä¸»èŠ‚ç‚¹(master/leader)ï¼Œåè€…ç§°ä¸ºä»èŠ‚ç‚¹(slave/follower)ï¼›</li>
<li><p>æ•°æ®çš„å¤åˆ¶æ˜¯å•å‘çš„ï¼Œåªèƒ½ç”±ä¸»èŠ‚ç‚¹åˆ°ä»èŠ‚ç‚¹ã€‚<strong>Masterä»¥å†™æ“ä½œä¸ºä¸»ï¼ŒSlave ä»¥è¯»æ“ä½œä¸ºä¸»</strong>ã€‚</p>
</li>
<li><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯å°RedisæœåŠ¡å™¨éƒ½æ˜¯ä¸»èŠ‚ç‚¹ï¼›</p>
</li>
<li>ä¸€ä¸ªä¸»èŠ‚ç‚¹å¯ä»¥æœ‰å¤šä¸ªä»èŠ‚ç‚¹(æˆ–æ²¡æœ‰ä»èŠ‚ç‚¹)ï¼Œä½†ä¸€ä¸ªä»èŠ‚ç‚¹åªèƒ½æœ‰ä¸€ä¸ªä¸»èŠ‚ç‚¹</li>
</ul>
<h3 id="2ï¼‰ä½œç”¨"><a href="#2ï¼‰ä½œç”¨" class="headerlink" title="2ï¼‰ä½œç”¨"></a>2ï¼‰ä½œç”¨</h3><ul>
<li>æ•°æ®å†—ä½™ï¼šä¸»ä»å¤åˆ¶å®ç°äº†æ•°æ®çš„çƒ­å¤‡ä»½ï¼Œæ˜¯æŒä¹…åŒ–ä¹‹å¤–çš„ä¸€ç§æ•°æ®å†—ä½™æ–¹å¼ã€‚</li>
<li>æ•…éšœæ¢å¤ï¼šå½“ä¸»èŠ‚ç‚¹å‡ºç°é—®é¢˜æ—¶ï¼Œå¯ä»¥ç”±ä»èŠ‚ç‚¹æä¾›æœåŠ¡ï¼Œå®ç°å¿«é€Ÿçš„æ•…éšœæ¢å¤ï¼›å®é™…ä¸Šæ˜¯ä¸€ç§æœåŠ¡<br>çš„å†—ä½™ã€‚</li>
<li>è´Ÿè½½å‡è¡¡ï¼šåœ¨ä¸»ä»å¤åˆ¶çš„åŸºç¡€ä¸Šï¼Œé…åˆè¯»å†™åˆ†ç¦»ï¼Œå¯ä»¥ç”±ä¸»èŠ‚ç‚¹æä¾›å†™æœåŠ¡ï¼Œç”±ä»èŠ‚ç‚¹æä¾›è¯»æœåŠ¡<br>ï¼ˆå³å†™Redisæ•°æ®æ—¶åº”ç”¨è¿æ¥ä¸»èŠ‚ç‚¹ï¼Œè¯»Redisæ•°æ®æ—¶åº”ç”¨è¿æ¥ä»èŠ‚ç‚¹ï¼‰ï¼Œåˆ†æ‹…æœåŠ¡å™¨è´Ÿè½½ï¼›å°¤å…¶æ˜¯åœ¨å†™<br>å°‘è¯»å¤šçš„åœºæ™¯ä¸‹ï¼Œé€šè¿‡å¤šä¸ªä»èŠ‚ç‚¹åˆ†æ‹…è¯»è´Ÿè½½ï¼Œå¯ä»¥å¤§å¤§æé«˜RedisæœåŠ¡å™¨çš„å¹¶å‘é‡ã€‚</li>
<li>é«˜å¯ç”¨ï¼ˆé›†ç¾¤ï¼‰åŸºçŸ³ï¼šé™¤äº†ä¸Šè¿°ä½œç”¨ä»¥å¤–ï¼Œä¸»ä»å¤åˆ¶è¿˜æ˜¯å“¨å…µå’Œé›†ç¾¤èƒ½å¤Ÿå®æ–½çš„åŸºç¡€ï¼Œå› æ­¤è¯´ä¸»ä»å¤<br>åˆ¶æ˜¯Redisé«˜å¯ç”¨çš„åŸºç¡€</li>
</ul>
<h3 id="3ï¼‰ç¯å¢ƒé…ç½®"><a href="#3ï¼‰ç¯å¢ƒé…ç½®" class="headerlink" title="3ï¼‰ç¯å¢ƒé…ç½®"></a>3ï¼‰ç¯å¢ƒé…ç½®</h3><ul>
<li><p>å¯é€šè¿‡<code>info replication</code> æŸ¥çœ‹å½“å‰åº“çš„ä¿¡æ¯</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> info replication <span class="token comment"># æŸ¥çœ‹å½“å‰åº“çš„ä¿¡æ¯</span>
<span class="token comment"># Replication</span>
role:master <span class="token comment"># è§’è‰² ä¸»æœåŠ¡å™¨</span>
connected_slaves:0 <span class="token comment"># æ²¡æœ‰ä»æœº</span>
master_replid:b63c90e6c501143759cb0e7f450bd1eb0c70882a
master_replid2:0000000000000000000000000000000000000000
master_repl_offset:0
second_repl_offset:-1
repl_backlog_active:0
repl_backlog_size:1048576
repl_backlog_first_byte_offset:0
repl_backlog_histlen:0</code></pre>
</li>
<li><p>é…ç½®å¤šä¸ªRedisæœåŠ¡å™¨æ—¶ï¼Œåªéœ€è¦å¤åˆ¶åŸå…ˆçš„redis.confé…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹å…¶ä¸­çš„<code>ç«¯å£å·</code>ã€<code>pidåå­—</code>ã€<code>logæ–‡ä»¶åå­—</code>ã€<code>dumb.rdbæ–‡ä»¶åå­—</code>å³å¯</p>
</li>
<li><p>å¯é€šè¿‡<code>SLAVEOF host 6379</code>è®¾ç½®ä¸»ä»å…³ç³»ï¼Œä½†åªæ˜¯æš‚æ—¶çš„ï¼Œredisé‡å¯åå¤±æ•ˆ</p>
<ul>
<li>ä¸»æœºæ–­å¼€è¿æ¥ï¼Œä»æœºä¾æ—§è¿æ¥åˆ°ä¸»æœºçš„ï¼Œä½†æ˜¯æ²¡æœ‰å†™æ“ä½œï¼Œè¿™ä¸ªæ—¶å€™ï¼Œä¸»æœºå¦‚æœå›æ¥äº†ï¼Œä»æœºä¾<br>æ—§å¯ä»¥ç›´æ¥è·å–åˆ°ä¸»æœºå†™çš„ä¿¡æ¯ï¼</li>
<li>ä¸»æœºå¯ä»¥å†™ï¼Œä»æœºä¸èƒ½å†™åªèƒ½è¯»ï¼ä¸»æœºä¸­çš„æ‰€æœ‰ä¿¡æ¯å’Œæ•°æ®ï¼Œéƒ½ä¼šè‡ªåŠ¨è¢«ä»æœºæ‰€ä¿å­˜ã€‚</li>
</ul>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">0</span>></span> SLAVEOF <span class="token number">127.0</span>.0.1 <span class="token number">6379</span> <span class="token comment"># SLAVEOF host 6379 æ‰¾è°å½“è‡ªå·±çš„è€å¤§ï¼</span>
OK
<span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">0</span>></span> info replication
<span class="token comment"># Replication</span>
role:slave <span class="token comment"># å½“å‰è§’è‰²æ˜¯ä»æœº</span>
master_host:127.0.0.1 <span class="token comment"># å¯ä»¥çš„çœ‹åˆ°ä¸»æœºçš„ä¿¡æ¯</span>
master_port:6379
master_link_status:up
master_last_io_seconds_ago:3
master_sync_in_progress:0
slave_repl_offset:14
slave_priority:100
slave_read_only:1
connected_slaves:0
master_replid:a81be8dd257636b2d3e7a9f595e69d73ff03774e
master_replid2:0000000000000000000000000000000000000000
master_repl_offset:14
second_repl_offset:-1
repl_backlog_active:1
repl_backlog_size:1048576
repl_backlog_first_byte_offset:1
repl_backlog_histlen:14

<span class="token comment"># åœ¨ä¸»æœºä¸­æŸ¥çœ‹ï¼</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> info replication
<span class="token comment"># Replication</span>
role:master
connected_slaves:1 <span class="token comment"># å¤šäº†ä»æœºçš„é…ç½®</span>
slave0:ip<span class="token operator">=</span><span class="token number">127.0</span>.0.1,port<span class="token operator">=</span><span class="token number">6380</span>,state<span class="token operator">=</span>online,offset<span class="token operator">=</span><span class="token number">42</span>,lag<span class="token operator">=</span><span class="token number">1</span> <span class="token comment"># å¤šäº†ä»æœºçš„é…ç½®</span>
master_replid:a81be8dd257636b2d3e7a9f595e69d73ff03774e
master_replid2:0000000000000000000000000000000000000000
master_repl_offset:42
second_repl_offset:-1
repl_backlog_active:1
repl_backlog_size:1048576
repl_backlog_first_byte_offset:1
repl_backlog_histlen:42</code></pre>
</li>
<li><p>å¤åˆ¶åŸç†ï¼š</p>
<p>Slave å¯åŠ¨æˆåŠŸå¹¶è¿æ¥åˆ° master åä¼šå‘é€ä¸€ä¸ªsyncåŒæ­¥å‘½ä»¤ï¼›Master æ¥åˆ°å‘½ä»¤åï¼Œå¯åŠ¨åå°çš„å­˜ç›˜è¿›ç¨‹ï¼ŒåŒæ—¶æ”¶é›†æ‰€æœ‰æ¥æ”¶åˆ°çš„ç”¨äºä¿®æ”¹æ•°æ®é›†å‘½ä»¤ï¼Œåœ¨åå°è¿›ç¨‹æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œmasterå°†ä¼ é€æ•´ä¸ªæ•°æ®æ–‡ä»¶åˆ°slaveï¼Œå¹¶å®Œæˆä¸€æ¬¡å®Œå…¨åŒæ­¥ã€‚</p>
</li>
</ul>
<h3 id="4ï¼‰å“¨å…µæ¨¡å¼"><a href="#4ï¼‰å“¨å…µæ¨¡å¼" class="headerlink" title="4ï¼‰å“¨å…µæ¨¡å¼"></a>4ï¼‰å“¨å…µæ¨¡å¼</h3><p>ä¸»ä»åˆ‡æ¢æŠ€æœ¯çš„æ–¹æ³•æ˜¯ï¼šå½“ä¸»æœåŠ¡å™¨å®•æœºåï¼Œéœ€è¦æ‰‹åŠ¨æŠŠä¸€å°ä»æœåŠ¡å™¨åˆ‡æ¢ä¸ºä¸»æœåŠ¡å™¨ï¼Œè¿™å°±éœ€è¦äººå·¥<br>å¹²é¢„ï¼Œè´¹äº‹è´¹åŠ›ï¼Œè¿˜ä¼šé€ æˆä¸€æ®µæ—¶é—´å†…æœåŠ¡ä¸å¯ç”¨ã€‚Redisä»2.8å¼€å§‹æ­£å¼æä¾›äº†Sentinelï¼ˆå“¨å…µï¼‰æ¶æ„æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<p><img src="https://hexo-blog-1254804803.cos.ap-shanghai.myqcloud.com/img/20210129155115.jpg" srcset="/img/loading.gif" alt=""></p>
<p>è¿™é‡Œçš„å“¨å…µæœ‰ä¸¤ä¸ªä½œç”¨ï¼š</p>
<ul>
<li>é€šè¿‡å‘é€å‘½ä»¤ï¼Œè®©RedisæœåŠ¡å™¨è¿”å›å…¶è¿è¡ŒçŠ¶æ€ï¼ŒåŒ…æ‹¬ä¸»æœåŠ¡å™¨å’Œä»æœåŠ¡å™¨ã€‚</li>
<li>å½“å“¨å…µç›‘æµ‹åˆ°masterå®•æœºæ—¶ï¼Œä¼š<strong>è‡ªåŠ¨å°†æŸä¸ªslaveåˆ‡æ¢æˆmaster</strong>ï¼Œç„¶åé€šè¿‡å‘å¸ƒè®¢é˜…æ¨¡å¼é€šçŸ¥å…¶ä»–çš„ä»æœåŠ¡å™¨ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œè®©å®ƒä»¬åˆ‡æ¢ä¸»æœºã€‚</li>
</ul>
<p>ç„¶è€Œä¸€ä¸ªå“¨å…µè¿›ç¨‹å¯¹RedisæœåŠ¡å™¨è¿›è¡Œç›‘æ§ï¼Œå¯èƒ½ä¼šå‡ºç°é—®é¢˜ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤šä¸ªå“¨å…µè¿›è¡Œç›‘æ§ã€‚<br>å„ä¸ªå“¨å…µä¹‹é—´è¿˜ä¼šè¿›è¡Œç›‘æ§ï¼Œè¿™æ ·å°±å½¢æˆäº†å¤šå“¨å…µæ¨¡å¼ã€‚</p>
<p><img src="https://hexo-blog-1254804803.cos.ap-shanghai.myqcloud.com/img/20210129155304.jpg" srcset="/img/loading.gif" alt=""></p>
<p>å‡è®¾ä¸»æœåŠ¡å™¨å®•æœºï¼Œå“¨å…µ1å…ˆæ£€æµ‹åˆ°è¿™ä¸ªç»“æœï¼Œç³»ç»Ÿå¹¶ä¸ä¼šé©¬ä¸Šè¿›è¡Œfailoverè¿‡ç¨‹ï¼Œä»…ä»…æ˜¯å“¨å…µ1ä¸»è§‚çš„è®¤<br>ä¸ºä¸»æœåŠ¡å™¨ä¸å¯ç”¨ï¼Œè¿™ä¸ªç°è±¡æˆä¸º<strong>ä¸»è§‚ä¸‹çº¿</strong>ã€‚å½“åé¢çš„å“¨å…µä¹Ÿæ£€æµ‹åˆ°ä¸»æœåŠ¡å™¨ä¸å¯ç”¨ï¼Œå¹¶ä¸”æ•°é‡è¾¾åˆ°ä¸€<br>å®šå€¼æ—¶ï¼Œé‚£ä¹ˆ<strong>å“¨å…µä¹‹é—´å°±ä¼šè¿›è¡Œä¸€æ¬¡æŠ•ç¥¨</strong>ï¼ŒæŠ•ç¥¨çš„ç»“æœç”±ä¸€ä¸ªå“¨å…µå‘èµ·ï¼Œè¿›è¡Œfailover[æ•…éšœè½¬ç§»]æ“ä½œã€‚<br>åˆ‡æ¢æˆåŠŸåï¼Œå°±ä¼šé€šè¿‡å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼Œè®©å„ä¸ªå“¨å…µæŠŠè‡ªå·±ç›‘æ§çš„ä»æœåŠ¡å™¨å®ç°åˆ‡æ¢ä¸»æœºï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸º<br><strong>å®¢è§‚ä¸‹çº¿</strong>ã€‚</p>
<p>æµ‹è¯•ï¼š</p>
<ul>
<li><p>é…ç½®å“¨å…µçš„é…ç½®æ–‡ä»¶sentinel.conf</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Example sentinel.conf</span>
<span class="token comment"># å“¨å…µsentinelå®ä¾‹è¿è¡Œçš„ç«¯å£ é»˜è®¤26379</span>
port <span class="token number">26379</span>
<span class="token comment"># å“¨å…µsentinelçš„å·¥ä½œç›®å½•</span>
<span class="token function">dir</span> /tmp

<span class="token comment"># sentinel monitor &lt;master-name> &lt;ip> &lt;redis-port> &lt;quorum></span>
<span class="token comment"># master-name å¯ä»¥è‡ªå·±å‘½åçš„ä¸»èŠ‚ç‚¹åå­— åªèƒ½ç”±å­—æ¯A-zã€æ•°å­—0-9 ã€è¿™ä¸‰ä¸ªå­—ç¬¦".-_"ç»„æˆã€‚</span>
<span class="token comment"># quorum é…ç½®å¤šå°‘ä¸ªsentinelå“¨å…µç»Ÿä¸€è®¤ä¸ºmasterä¸»èŠ‚ç‚¹å¤±è” é‚£ä¹ˆè¿™æ—¶å®¢è§‚ä¸Šè®¤ä¸ºä¸»èŠ‚ç‚¹å¤±è”äº†</span>
sentinel monitor mymaster <span class="token number">127.0</span>.0.1 <span class="token number">6379</span> <span class="token number">2</span>

<span class="token comment"># å½“åœ¨Rediså®ä¾‹ä¸­å¼€å¯äº†requirepass foobared æˆæƒå¯†ç  è¿™æ ·æ‰€æœ‰è¿æ¥Rediså®ä¾‹çš„å®¢æˆ·ç«¯éƒ½è¦æä¾›å¯†ç </span>
<span class="token comment"># è®¾ç½®å“¨å…µsentinel è¿æ¥ä¸»ä»çš„å¯†ç  æ³¨æ„å¿…é¡»ä¸ºä¸»ä»è®¾ç½®ä¸€æ ·çš„éªŒè¯å¯†ç </span>
<span class="token comment"># sentinel auth-pass &lt;master-name> &lt;password></span>
sentinel auth-pass mymaster MySUPER--secret-0123passw0rd

<span class="token comment"># æŒ‡å®šå¤šå°‘æ¯«ç§’ä¹‹å ä¸»èŠ‚ç‚¹æ²¡æœ‰åº”ç­”å“¨å…µsentinel æ­¤æ—¶ å“¨å…µä¸»è§‚ä¸Šè®¤ä¸ºä¸»èŠ‚ç‚¹ä¸‹çº¿ é»˜è®¤30ç§’</span>
<span class="token comment"># sentinel down-after-milliseconds &lt;master-name> &lt;milliseconds></span>
sentinel down-after-milliseconds mymaster <span class="token number">30000</span>

<span class="token comment"># è¿™ä¸ªé…ç½®é¡¹æŒ‡å®šäº†åœ¨å‘ç”Ÿfailoverä¸»å¤‡åˆ‡æ¢æ—¶æœ€å¤šå¯ä»¥æœ‰å¤šå°‘ä¸ªslaveåŒæ—¶å¯¹æ–°çš„masterè¿›è¡Œ åŒæ­¥ï¼Œè¿™ä¸ªæ•°å­—è¶Šå°ï¼Œå®Œæˆfailoveræ‰€éœ€çš„æ—¶é—´å°±è¶Šé•¿ï¼Œä½†æ˜¯å¦‚æœè¿™ä¸ªæ•°å­—è¶Šå¤§ï¼Œå°±æ„å‘³ç€è¶Š å¤šçš„slaveå› ä¸ºreplicationè€Œä¸å¯ç”¨ã€‚å¯ä»¥é€šè¿‡å°†è¿™ä¸ªå€¼è®¾ä¸º 1 æ¥ä¿è¯æ¯æ¬¡åªæœ‰ä¸€ä¸ªslave å¤„äºä¸èƒ½å¤„ç†å‘½ä»¤è¯·æ±‚çš„çŠ¶æ€ã€‚</span>
<span class="token comment"># sentinel parallel-syncs &lt;master-name> &lt;numslaves></span>
sentinel parallel-syncs mymaster <span class="token number">1</span>

<span class="token comment"># æ•…éšœè½¬ç§»çš„è¶…æ—¶æ—¶é—´ failover-timeout å¯ä»¥ç”¨åœ¨ä»¥ä¸‹è¿™äº›æ–¹é¢ï¼š</span>
<span class="token comment">#1. åŒä¸€ä¸ªsentinelå¯¹åŒä¸€ä¸ªmasterä¸¤æ¬¡failoverä¹‹é—´çš„é—´éš”æ—¶é—´ã€‚</span>
<span class="token comment">#2. å½“ä¸€ä¸ªslaveä»ä¸€ä¸ªé”™è¯¯çš„masteré‚£é‡ŒåŒæ­¥æ•°æ®å¼€å§‹è®¡ç®—æ—¶é—´ã€‚ç›´åˆ°slaveè¢«çº æ­£ä¸ºå‘æ­£ç¡®çš„masteré‚£é‡ŒåŒæ­¥æ•°æ®æ—¶ã€‚</span>
<span class="token comment">#3.å½“æƒ³è¦å–æ¶ˆä¸€ä¸ªæ­£åœ¨è¿›è¡Œçš„failoveræ‰€éœ€è¦çš„æ—¶é—´ã€‚</span>
<span class="token comment">#4.å½“è¿›è¡Œfailoveræ—¶ï¼Œé…ç½®æ‰€æœ‰slavesæŒ‡å‘æ–°çš„masteræ‰€éœ€çš„æœ€å¤§æ—¶é—´ã€‚ä¸è¿‡ï¼Œå³ä½¿è¿‡äº†è¿™ä¸ªè¶…æ—¶ï¼Œslavesä¾ç„¶ä¼šè¢«æ­£ç¡®é…ç½®ä¸ºæŒ‡å‘masterï¼Œä½†æ˜¯å°±ä¸æŒ‰parallel-syncsæ‰€é…ç½®çš„è§„åˆ™æ¥äº†</span>
<span class="token comment"># é»˜è®¤ä¸‰åˆ†é’Ÿ</span>
<span class="token comment"># sentinel failover-timeout &lt;master-name> &lt;milliseconds></span>
sentinel failover-timeout mymaster <span class="token number">180000</span>

<span class="token comment"># SCRIPTS EXECUTION</span>
<span class="token comment">#é…ç½®å½“æŸä¸€äº‹ä»¶å‘ç”Ÿæ—¶æ‰€éœ€è¦æ‰§è¡Œçš„è„šæœ¬ï¼Œå¯ä»¥é€šè¿‡è„šæœ¬æ¥é€šçŸ¥ç®¡ç†å‘˜ï¼Œä¾‹å¦‚å½“ç³»ç»Ÿè¿è¡Œä¸æ­£å¸¸æ—¶å‘é‚®ä»¶é€šçŸ¥ç›¸å…³äººå‘˜ã€‚</span>
<span class="token comment">#å¯¹äºè„šæœ¬çš„è¿è¡Œç»“æœæœ‰ä»¥ä¸‹è§„åˆ™ï¼š</span>
<span class="token comment">#è‹¥è„šæœ¬æ‰§è¡Œåè¿”å›1ï¼Œé‚£ä¹ˆè¯¥è„šæœ¬ç¨åå°†ä¼šè¢«å†æ¬¡æ‰§è¡Œï¼Œé‡å¤æ¬¡æ•°ç›®å‰é»˜è®¤ä¸º10</span>
<span class="token comment">#è‹¥è„šæœ¬æ‰§è¡Œåè¿”å›2ï¼Œæˆ–è€…æ¯”2æ›´é«˜çš„ä¸€ä¸ªè¿”å›å€¼ï¼Œè„šæœ¬å°†ä¸ä¼šé‡å¤æ‰§è¡Œã€‚</span>
<span class="token comment">#å¦‚æœè„šæœ¬åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ç”±äºæ”¶åˆ°ç³»ç»Ÿä¸­æ–­ä¿¡å·è¢«ç»ˆæ­¢äº†ï¼Œåˆ™åŒè¿”å›å€¼ä¸º1æ—¶çš„è¡Œä¸ºç›¸åŒã€‚</span>
<span class="token comment">#ä¸€ä¸ªè„šæœ¬çš„æœ€å¤§æ‰§è¡Œæ—¶é—´ä¸º60sï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªæ—¶é—´ï¼Œè„šæœ¬å°†ä¼šè¢«ä¸€ä¸ªSIGKILLä¿¡å·ç»ˆæ­¢ï¼Œä¹‹åé‡æ–°æ‰§è¡Œã€‚</span>
<span class="token comment">#é€šçŸ¥å‹è„šæœ¬:å½“sentinelæœ‰ä»»ä½•è­¦å‘Šçº§åˆ«çš„äº‹ä»¶å‘ç”Ÿæ—¶ï¼ˆæ¯”å¦‚è¯´rediså®ä¾‹çš„ä¸»è§‚å¤±æ•ˆå’Œå®¢è§‚å¤±æ•ˆç­‰ç­‰ï¼‰ï¼Œå°†ä¼šå»è°ƒç”¨è¿™ä¸ªè„šæœ¬ï¼Œè¿™æ—¶è¿™ä¸ªè„šæœ¬åº”è¯¥é€šè¿‡é‚®ä»¶ï¼ŒSMSç­‰æ–¹å¼å»é€šçŸ¥ç³»ç»Ÿç®¡ç†å‘˜å…³äºç³»ç»Ÿä¸æ­£å¸¸è¿è¡Œçš„ä¿¡æ¯ã€‚è°ƒç”¨è¯¥è„šæœ¬æ—¶ï¼Œå°†ä¼ ç»™è„šæœ¬ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯äº‹ä»¶çš„ç±»å‹ï¼Œä¸€ä¸ªæ˜¯äº‹ä»¶çš„æè¿°ã€‚å¦‚æœsentinel.confé…ç½®æ–‡ä»¶ä¸­é…ç½®äº†è¿™ä¸ªè„šæœ¬è·¯å¾„ï¼Œé‚£ä¹ˆå¿…é¡»ä¿è¯è¿™ä¸ªè„šæœ¬å­˜åœ¨äºè¿™ä¸ªè·¯å¾„ï¼Œå¹¶ä¸”æ˜¯å¯æ‰§è¡Œçš„ï¼Œå¦åˆ™sentinelæ— æ³•æ­£å¸¸å¯åŠ¨æˆåŠŸã€‚</span>
<span class="token comment">#é€šçŸ¥è„šæœ¬</span>
<span class="token comment"># shellç¼–ç¨‹</span>
<span class="token comment"># sentinel notification-script &lt;master-name> &lt;script-path></span>
sentinel notification-script mymaster /var/redis/notify.sh

<span class="token comment"># å®¢æˆ·ç«¯é‡æ–°é…ç½®ä¸»èŠ‚ç‚¹å‚æ•°è„šæœ¬</span>
<span class="token comment"># å½“ä¸€ä¸ªmasterç”±äºfailoverè€Œå‘ç”Ÿæ”¹å˜æ—¶ï¼Œè¿™ä¸ªè„šæœ¬å°†ä¼šè¢«è°ƒç”¨ï¼Œé€šçŸ¥ç›¸å…³çš„å®¢æˆ·ç«¯å…³äºmasteråœ°å€å·²ç»å‘ç”Ÿæ”¹å˜çš„ä¿¡æ¯ã€‚</span>
<span class="token comment"># ä»¥ä¸‹å‚æ•°å°†ä¼šåœ¨è°ƒç”¨è„šæœ¬æ—¶ä¼ ç»™è„šæœ¬:</span>
<span class="token comment"># &lt;master-name> &lt;role> &lt;state> &lt;from-ip> &lt;from-port> &lt;to-ip> &lt;to-port></span>
<span class="token comment"># ç›®å‰&lt;state>æ€»æ˜¯â€œfailoverâ€,</span>
<span class="token comment"># &lt;role>æ˜¯â€œleaderâ€æˆ–è€…â€œobserverâ€ä¸­çš„ä¸€ä¸ªã€‚</span>
<span class="token comment"># å‚æ•° from-ip, from-port, to-ip, to-portæ˜¯ç”¨æ¥å’Œæ—§çš„masterå’Œæ–°çš„master(å³æ—§çš„slave)é€šä¿¡çš„</span>
<span class="token comment"># è¿™ä¸ªè„šæœ¬åº”è¯¥æ˜¯é€šç”¨çš„ï¼Œèƒ½è¢«å¤šæ¬¡è°ƒç”¨ï¼Œä¸æ˜¯é’ˆå¯¹æ€§çš„ã€‚</span>
<span class="token comment"># sentinel client-reconfig-script &lt;master-name> &lt;script-path></span>
sentinel client-reconfig-script mymaster /var/redis/reconfig.sh <span class="token comment"># ä¸€èˆ¬éƒ½æ˜¯ç”±è¿ç»´æ¥é…ç½®ï¼</span></code></pre>
</li>
<li><p>å¯åŠ¨ï¼š<code>redis-sentinel kconfig/sentinel.conf</code></p>
</li>
</ul>
<h2 id="åã€ç¼“å­˜ç©¿é€å’Œé›ªå´©"><a href="#åã€ç¼“å­˜ç©¿é€å’Œé›ªå´©" class="headerlink" title="åã€ç¼“å­˜ç©¿é€å’Œé›ªå´©"></a>åã€ç¼“å­˜ç©¿é€å’Œé›ªå´©</h2><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:left">ç¼“å­˜ç©¿é€</th>
<th style="text-align:left">ç¼“å­˜å‡»ç©¿</th>
<th style="text-align:left">ç¼“å­˜é›ªå´©</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">æ¦‚å¿µ</td>
<td style="text-align:left"><strong>æŸ¥ä¸åˆ°</strong>ï¼šç”¨æˆ·æƒ³è¦æŸ¥è¯¢ä¸€ä¸ªæ•°æ®ï¼Œå‘ç°redisç¼“å­˜æ•°æ®åº“æ²¡æœ‰ï¼Œäºæ˜¯å‘æŒä¹…å±‚æ•°æ®åº“æŸ¥è¯¢ï¼Œå‘ç°ä¹Ÿæ²¡æœ‰ï¼Œæœ¬æ¬¡æŸ¥è¯¢å¤±è´¥ã€‚å½“ç”¨æˆ·å¾ˆå¤šçš„æ—¶å€™ï¼Œç¼“å­˜éƒ½æ²¡æœ‰å‘½ä¸­ï¼Œäºæ˜¯éƒ½å»è¯·æ±‚äº†æŒä¹…å±‚æ•°æ®åº“ã€‚è¿™ä¼šç»™æŒä¹…å±‚æ•°æ®åº“é€ æˆå¾ˆå¤§çš„å‹åŠ›ï¼Œå³ç¼“å­˜ç©¿é€ã€‚</td>
<td style="text-align:left"><strong>é«˜å¹¶å‘+ç¼“å­˜è¿‡æœŸ</strong>ï¼šä¸€ä¸ªkeyéå¸¸çƒ­ç‚¹ï¼Œåœ¨ä¸åœçš„æ‰›ç€å¤§å¹¶å‘ï¼›å½“è¿™ä¸ªkeyåœ¨å¤±æ•ˆçš„ç¬é—´ï¼ŒæŒç»­çš„å¤§å¹¶å‘å°±ç©¿ç ´ç¼“å­˜ï¼Œç›´æ¥è¯·æ±‚æ•°æ®åº“ï¼Œä½¿æ•°æ®åº“ç¬é—´å‹åŠ›è¿‡å¤§ï¼Œå°±åƒåœ¨ä¸€ä¸ªå±éšœä¸Šå‡¿å¼€äº†ä¸€ä¸ªæ´ã€‚</td>
<td style="text-align:left">åœ¨æŸä¸€ä¸ªæ—¶é—´æ®µï¼Œç¼“å­˜é›†ä¸­è¿‡æœŸå¤±æ•ˆï¼ŒRedis å®•æœºã€‚</td>
</tr>
<tr>
<td style="text-align:center">è§£å†³æ–¹æ¡ˆ</td>
<td style="text-align:left">1.<strong>å¸ƒéš†è¿‡æ»¤å™¨</strong>:å¯¹æ‰€æœ‰å¯èƒ½æŸ¥è¯¢çš„å‚æ•°ä»¥hashå½¢å¼å­˜å‚¨ï¼Œåœ¨æ§åˆ¶å±‚å…ˆè¿›è¡Œæ ¡éªŒï¼Œä¸ç¬¦åˆåˆ™ä¸¢å¼ƒï¼Œä»è€Œç¼“è§£äº†å¯¹åº•å±‚å­˜å‚¨ç³»ç»Ÿçš„æŸ¥è¯¢å‹åŠ›ï¼›<br/>2.<strong>ç¼“å­˜ç©ºå¯¹è±¡</strong>ï¼šå½“æ•°æ®åº“ä¸å‘½ä¸­åï¼Œå³ä½¿è¿”å›çš„æ˜¯ç©ºå¯¹è±¡ä¹Ÿå°†å…¶ç¼“å­˜èµ·æ¥ï¼ŒåŒæ—¶ä¼šè®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼Œä¹‹åå†è®¿é—®è¿™ä¸ªæ•°æ®æ—¶å°†ä¼šä»ç¼“å­˜ä¸­è·å–ï¼Œä¿æŠ¤äº†åç«¯æ•°æ®æºã€‚ï¼ˆå¦‚æœç©ºå€¼èƒ½å¤Ÿè¢«ç¼“å­˜èµ·æ¥ï¼Œè¿™å°±æ„å‘³ç€ç¼“å­˜éœ€è¦æ›´å¤šçš„ç©ºé—´å­˜å‚¨æ›´å¤šçš„é”®ï¼Œå› ä¸ºè¿™å½“ä¸­å¯èƒ½ä¼šæœ‰å¾ˆå¤šçš„ç©ºå€¼çš„é”®ï¼›å³ä½¿å¯¹ç©ºå€¼è®¾ç½®äº†è¿‡æœŸæ—¶é—´ï¼Œè¿˜æ˜¯ä¼šå­˜åœ¨ç¼“å­˜å±‚å’Œå­˜å‚¨å±‚çš„æ•°æ®ä¼šæœ‰ä¸€æ®µæ—¶é—´çª—å£çš„ä¸ä¸€è‡´ï¼Œè¿™å¯¹äºéœ€è¦ä¿æŒä¸€è‡´æ€§çš„ä¸šåŠ¡ä¼šæœ‰å½±å“ã€‚ï¼‰</td>
<td style="text-align:left">1.<strong>è®¾ç½®çƒ­ç‚¹æ•°æ®æ°¸ä¸è¿‡æœŸ</strong>ï¼šä»ç¼“å­˜å±‚é¢æ¥çœ‹ï¼Œæ²¡æœ‰è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°çƒ­ç‚¹ key è¿‡æœŸåäº§ç”Ÿçš„é—®é¢˜ã€‚<br/>2.<strong>åŠ äº’æ–¥é”</strong><br/>ä½¿ç”¨åˆ†å¸ƒå¼é”ï¼Œå¯ä¿è¯å¯¹äºæ¯ä¸ªkeyè€Œå·²ï¼ŒåŒæ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹å»æŸ¥è¯¢åç«¯æœåŠ¡ï¼Œå…¶ä»–çº¿ç¨‹æ²¡æœ‰è·å¾—åˆ†å¸ƒå¼é”çš„æƒé™ï¼Œå› æ­¤åªéœ€è¦ç­‰å¾…å³å¯ã€‚è¿™ç§æ–¹å¼å°†é«˜å¹¶å‘çš„å‹åŠ›è½¬ç§»åˆ°äº†åˆ†å¸ƒå¼é”ï¼Œå› æ­¤å¯¹åˆ†å¸ƒå¼é”çš„è€ƒéªŒå¾ˆå¤§ã€‚</td>
<td style="text-align:left">1.<strong>redisé«˜å¯ç”¨</strong>ï¼šå¤šå¢è®¾å‡ å°redisï¼Œè¿™æ ·ä¸€å°æŒ‚æ‰ä¹‹åå…¶ä»–çš„è¿˜å¯ä»¥ç»§ç»­å·¥ä½œï¼Œå…¶å®å°±æ˜¯æ­å»ºçš„é›†ç¾¤ã€‚ï¼ˆå¼‚åœ°å¤šæ´»ï¼ï¼‰<br/>2.<strong>é™æµé™çº§</strong>ï¼ˆåœ¨SpringCloudè®²è§£è¿‡ï¼ï¼‰è¿™ä¸ªè§£å†³æ–¹æ¡ˆçš„æ€æƒ³æ˜¯ï¼Œåœ¨ç¼“å­˜å¤±æ•ˆåï¼Œé€šè¿‡åŠ é”æˆ–è€…é˜Ÿåˆ—æ¥æ§åˆ¶è¯»æ•°æ®åº“å†™ç¼“å­˜çš„çº¿ç¨‹æ•°é‡ã€‚æ¯”å¦‚å¯¹æŸä¸ªkeyåªå…è®¸ä¸€ä¸ªçº¿ç¨‹æŸ¥è¯¢æ•°æ®å’Œå†™ç¼“å­˜ï¼Œå…¶ä»–çº¿ç¨‹ç­‰å¾…ã€‚<br/>3.<strong>æ•°æ®é¢„çƒ­</strong>ï¼šåœ¨æ­£å¼éƒ¨ç½²ä¹‹å‰ï¼Œå…ˆæŠŠå¯èƒ½çš„æ•°æ®å…ˆé¢„å…ˆè®¿é—®ä¸€éï¼Œè¿™æ ·éƒ¨åˆ†å¯èƒ½å¤§é‡è®¿é—®çš„æ•°æ®å°±ä¼šåŠ è½½åˆ°ç¼“å­˜ä¸­ã€‚åœ¨å³å°†å‘ç”Ÿå¤§å¹¶å‘è®¿é—®å‰æ‰‹åŠ¨è§¦å‘åŠ è½½ç¼“å­˜ä¸åŒçš„keyï¼Œè®¾ç½®ä¸åŒçš„è¿‡æœŸæ—¶é—´ï¼Œè®©ç¼“å­˜å¤±æ•ˆçš„æ—¶é—´ç‚¹å°½é‡å‡åŒ€ã€‚</td>
</tr>
</tbody>
</table>
</div>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p>ã€1ã€‘<a target="_blank" rel="noopener" href="https://blog.csdn.net/lijie0213/article/details/108129934">https://blog.csdn.net/lijie0213/article/details/108129934</a></p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">æ•°æ®åº“</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/Redis/">Redis</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 åè®®</a> ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p>
              
              
                <div class="post-prevnext row">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/posts/d04bd5bc/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">æ“ä½œç³»ç»Ÿ</span>
                        <span class="visible-mobile">ä¸Šä¸€ç¯‡</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/posts/401f2bf8/">
                        <span class="hidden-mobile">JVMåŸºç¡€è‡ªæŸ¥æ‰‹å†Œ</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments">
                
                
  <div id="vcomments"></div>
  <script type="text/javascript">
    Fluid.utils.waitElementVisible('vcomments', function() {
      Fluid.utils.createScript('https://cdn.staticfile.org/valine/1.4.14/Valine.min.js', function () {
        new Valine({
          el: "#vcomments",
          app_id: "ViwB1XmjsmmXpFx2gikUmM5V-gzGzoHsz",
          app_key: "7r6Y8CzBkl8MJwPNmCqSdLWW",
          placeholder: "æ¥éƒ½æ¥äº†ï¼Œä¸è¯´ç‚¹ä»€ä¹ˆå—âŠ™(ãƒ»â—‡ãƒ»)ï¼Ÿ",
          path: window.location.pathname,
          avatar: "retro",
          meta: ["nick","mail","link"],
          pageSize: "10",
          lang: "zh-CN",
          highlight: false,
          recordIP: false,
          serverURLs: "",
        });
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the
    <a target="_blank" href="https://valine.js.org" rel="nofollow noopener noopener">comments powered by Valine.</a>
  </noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <i class="iconfont icon-tags-fill"></i>&nbsp;<a href="http://www.beian.miit.gov.cn/" target="_blank">é²ICPå¤‡19062448å·</a>&nbsp&nbsp;| &nbsp&nbsp <i class="iconfont icon-addrcard"></i>&nbsp; 2018~2022<a href="https://www.jngwl.top/" target="_blank"> æ¸…é£ä¸å½’_G</a>&nbsp&nbsp;|&nbsp&nbsp;  <i class="iconfont icon-docker"></i> <a href="https://hexo.io/" target="_blank">&nbsp Hexo</a>&nbsp & &nbsp <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank">Fluid</a><br> ä½ çš„éª„å‚²å¤šåŠæ¥è‡ªäºè‡ªå·±çš„æ— çŸ¥ï¼Œå…±å‹‰ä¹‹

  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- LeanCloud ç»Ÿè®¡PV -->
        <span id="leancloud-site-pv-container" style="display: none">
            æ€»è®¿é—®é‡ 
            <span id="leancloud-site-pv"></span>
             æ¬¡
          </span>
      
      
        <!-- LeanCloud ç»Ÿè®¡UV -->
        <span id="leancloud-site-uv-container" style="display: none">
            æ€»è®¿å®¢æ•° 
            <span id="leancloud-site-uv"></span>
             äºº
          </span>
      

    
  </div>


  

  
</footer>

<!-- SCRIPTS -->

  <script  src="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":200})
    NProgress.start()
    document.addEventListener('DOMContentLoaded', function() {
      window.NProgress && window.NProgress.inc();
    })
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.staticfile.org/jquery/3.5.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.5.3/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  
    
  



  <script  src="https://cdn.staticfile.org/tocbot/4.12.0/tocbot.min.js" ></script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>



  <script defer src="/js/leancloud.js" ></script>



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/local-search.xml";
      var inputArea = document.querySelector("#local-search-input");
      inputArea.onclick = function () {
        searchFunc(path, 'local-search-input', 'local-search-result');
        this.onclick = null
      }
    })()
  </script>












  

  

  

  

  

  





<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ ä¿æŒåœ¨æœ€åº•éƒ¨ -->
<script  src="/js/boot.js" ></script>



</body>
</html>
